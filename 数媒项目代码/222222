<!DOCTYPE html>
<html lang="zh-CN" xmlns:https="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>气候变化舆情分析平台</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            accent: '#722ED1',
            warning: '#FF7D00',
            danger: '#F53F3F',
            success: '#00B42A',
            dark: {
              100: '#86909C',
              200: '#4E5969',
              300: '#272E3B',
              400: '#1D2129',
              500: '#141414'
            }
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 3s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            }
          }
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:shadow-primary/20 hover:-translate-y-1;
      }
      .glass-effect {
        @apply bg-dark-400/80 backdrop-blur-md;
      }
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      .scrollbar-thin::-webkit-scrollbar {
        width: 4px;
      }
      .scrollbar-thin::-webkit-scrollbar-track {
        background: transparent;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
        background-color: rgba(156, 163, 175, 0.5);
        border-radius: 20px;
      }
      .nav-active {
        @apply bg-primary/10 text-primary border-l-4 border-primary;
      }
    }
  </style>
</head>

<body class="bg-dark-500 text-white font-inter antialiased min-h-screen flex flex-col overflow-hidden">
  <div class="flex h-screen">
    <!-- 左侧导航栏 -->
    <aside class="w-48 bg-dark-400 border-r border-dark-300 flex-shrink-0 hidden md:block transition-all duration-300 z-40">
      <!-- Logo 和标题 -->
      <div class="flex items-center space-x-2 p-4 border-b border-dark-300">
        <div class="bg-primary/20 p-2 rounded-lg">
          <i class="fa fa-line-chart text-primary text-xl"></i>
        </div>
        <h1 class="text-lg font-bold bg-gradient-to-r from-primary to-secondary text-transparent bg-clip-text">
          气候变化舆情分析平台
        </h1>
      </div>

      <!-- 导航菜单 -->
      <nav class="py-4 w-48">
        <ul class="space-y-1 px-2">
          <li>
            <a href="#dashboard" class="nav-link nav-active flex items-center space-x-3 px-4 py-3 rounded-lg transition-all">
              <i class="fa fa-dashboard w-5 text-center"></i>
              <span class="text-sm">数据概览</span>
            </a>
          </li>
          <li>
            <a href="#trends" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-line-chart w-5 text-center"></i>
              <span class="text-sm">时间趋势</span>
            </a>
          </li>
          <li>
            <a href="#themes" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-tags w-5 text-center"></i>
              <span class="text-sm">主题分析</span>
            </a>
          </li>
          <li>
            <a href="#alerts" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-bell w-5 text-center"></i>
              <span class="text-sm">预警中心</span>
            </a>
          </li>
          <li>
            <a href="#timeline" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-history w-5 text-center"></i>
              <span class="text-sm">气候时间线</span>
            </a>
          </li>
          <li>
            <a href="#news-policy" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-newspaper-o w-5 text-center"></i>
              <span class="text-sm">新闻政策</span>
            </a>
          </li>
          <li>
            <a href="#discussion" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-comments w-5 text-center"></i>
              <span class="text-sm">用户讨论</span>
            </a>
          </li>
          <li>
            <a href="#download-share" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-download w-5 text-center"></i>
              <span class="text-sm">数据分享</span>
            </a>
          </li>
          <li>
            <a href="#future-topic" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-magic w-5 text-center"></i>
              <span class="text-sm">AI预测</span>
            </a>
          </li>
        </ul>

        <div class="mt-8 px-4">
          <h3 class="text-xs uppercase text-dark-100 font-semibold px-4 mb-2">系统</h3>
          <ul class="space-y-1 px-2">
            <li>
              <a href="#" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
                <i class="fa fa-cog w-5 text-center"></i>
                <span class="text-sm">设置</span>
              </a>
            </li>
            <li>
              <a href="#" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
                <i class="fa fa-question-circle w-5 text-center"></i>
                <span class="text-sm">帮助中心</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- 底部用户信息 -->
      <!-- 左下角用户认证区 -->
      <div class="absolute bottom-0 left-0 p-2 w-48">
        <div class="w-47 h-px bg-dark-300 mb-2"></div>
        <div id="user-info" class="hidden flex items-center">
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary mr-3"></div>
          <div>
            <p class="text-xs font-medium text-white" id="user-nickname"></p>
            <!-- 可扩展：<p class="text-[10px] text-dark-100" id="user-email"></p> -->
          </div>
          <button id="logout-btn" class="ml-auto px-2 py-1 rounded-lg bg-primary text-white text-xs hover:bg-secondary transition-all">退出</button>
        </div>
        <div id="user-auth-entry" class="flex items-center">
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary mr-3"></div>
          <button id="auth-open-btn" class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-secondary transition-all text-xs">登录 / 注册</button>
        </div>
      </div>
    </aside>

    <!-- 主内容区域 -->
    <main class="flex-1 flex flex-col overflow-hidden">
      <!-- 顶部导航栏 -->
      <header class="h-16 bg-dark-400 border-b border-dark-300 flex items-center justify-between px-6 z-30">
        <!-- 移动端菜单按钮 --> 
        <button class="md:hidden p-2 rounded-md hover:bg-dark-300/50 transition-colors" id="mobile-menu-button">
          <i class="fa fa-bars text-dark-100"></i>
        </button>

        <!-- 数据状态 -->
        <div class="hidden md:flex items-center gap-2 text-dark-100">
          <span class="inline-block w-2 h-2 rounded-full bg-primary animate-pulse"></span>
          <span>数据实时更新中</span>
        </div>

        <!-- 右侧工具栏 -->
        <div class="flex items-center space-x-4">
          <div class="relative">
            <input type="text" placeholder="搜索..." class="bg-dark-300 border border-dark-200 rounded-lg py-1.5 pl-8 pr-3 w-40 lg:w-64 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-dark-100 text-sm"></i>
          </div>

          <button class="p-2 rounded-full hover:bg-dark-300/50 transition-colors relative">
            <i class="fa fa-bell-o text-dark-100"></i>
            <span class="absolute top-1 right-1 w-2 h-2 bg-danger rounded-full"></span>
          </button>
        </div>
      </header>

      <!-- 页面内容区域 -->
      <div class="flex-1 overflow-y-auto p-6 scrollbar-thin">
        <!-- 1. 数据概览页面 -->
        <div id="dashboard-page" class="page-content">
          <div class="mb-6">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">全国气候变化舆情概览</h2>
            <p class="text-dark-100 mt-1">实时监控全国范围内气候变化相关舆情动态与趋势</p>
          </div>


          <!-- 关键指标卡片 -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-dark-400 rounded-xl p-6 border border-dark-300 card-hover">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <p class="text-dark-100 text-sm">实时舆情总量</p>
                  <h3 class="text-3xl font-bold mt-1">128,543</h3>
                </div>
                <div class="bg-primary/10 p-2 rounded-lg">
                  <i class="fa fa-comments text-primary"></i>
                </div>
              </div>
              <div class="flex items-center text-sm">
                <span class="text-success flex items-center">
                  <i class="fa fa-arrow-up mr-1"></i> 12.5%
                </span>
                <span class="text-dark-100 ml-2">较昨日</span>
              </div>
            </div>

            <div class="bg-dark-400 rounded-xl p-6 border border-dark-300 card-hover">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <p class="text-dark-100 text-sm">情感倾向分布</p>
                  <div class="flex items-center mt-2">
                    <div class="relative w-16 h-16">
                      <canvas id="sentiment-donut"></canvas>
                    </div>
                    <div class="ml-3">
                      <div class="flex items-center">
                        <span class="w-2 h-2 rounded-full bg-danger mr-1"></span>
                        <span class="text-xs text-dark-100">消极 45%</span>
                      </div>
                      <div class="flex items-center">
                        <span class="w-2 h-2 rounded-full bg-warning mr-1"></span>
                        <span class="text-xs text-dark-100">中立 30%</span>
                      </div>
                      <div class="flex items-center">
                        <span class="w-2 h-2 rounded-full bg-success mr-1"></span>
                        <span class="text-xs text-dark-100">积极 25%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-dark-400 rounded-xl p-6 border border-dark-300 card-hover">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <p class="text-dark-100 text-sm">当日热点话题</p>
                  <div class="space-y-2 mt-2">
                    <div class="flex items-center">
                      <span class="bg-primary/10 text-primary text-xs px-2 py-1 rounded mr-2">#碳中和</span>
                      <span class="text-dark-100 text-xs">32.4k 讨论</span>
                    </div>
                    <div class="flex items-center">
                      <span class="bg-secondary/10 text-secondary text-xs px-2 py-1 rounded mr-2">#极端高温</span>
                      <span class="text-dark-100 text-xs">28.7k 讨论</span>
                    </div>
                    <div class="flex items-center">
                      <span class="bg-accent/10 text-accent text-xs px-2 py-1 rounded mr-2">#碳关税</span>
                      <span class="text-dark-100 text-xs">21.3k 讨论</span>
                    </div>
                  </div>
                </div>
                <div class="bg-secondary/10 p-2 rounded-lg">
                  <i class="fa fa-fire text-secondary"></i>
                </div>
              </div>
            </div>

            <div class="bg-dark-400 rounded-xl p-6 border border-dark-300 card-hover">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <p class="text-dark-100 text-sm">全国热点省份</p>
                  <div class="mt-2">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">

                        <span class="text-sm">广东</span>
                      </div>
                      <div class="w-24 bg-dark-300 rounded-full h-2">
                        <div class="bg-danger h-2 rounded-full" style="width: 85%"></div>
                      </div>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="flex items-center">

                        <span class="text-sm">北京</span>
                      </div>
                      <div class="w-24 bg-dark-300 rounded-full h-2">
                        <div class="bg-warning h-2 rounded-full" style="width: 72%"></div>
                      </div>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                      <div class="flex items-center">

                        <span class="text-sm">江西</span>
                      </div>
                      <div class="w-24 bg-dark-300 rounded-full h-2">
                        <div class="bg-primary h-2 rounded-full" style="width: 65%"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-accent/10 p-2 rounded-lg">
                  <i class="fa fa-globe text-accent"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- 数据筛选栏 -->
          <div class="bg-dark-400 rounded-xl p-4 border border-dark-300 shadow-lg mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                  <span class="text-dark-100 text-xs">地区:</span>
                  <select class="bg-dark-300 border border-dark-200 rounded-lg py-1.5 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <option>全国</option>
                    <option>北京</option>
                    <option>上海</option>
                    <option>广东</option>
                    <option>江苏</option>
                    <option>山东</option>
                    <option>浙江</option>
                    <option>四川</option>
                    <option>河南</option>
                    <option>湖北</option>
                    <option>湖南</option>
                    <option>陕西</option>
                    <option>云南</option>
                    <option>重庆</option>
                    <option>广西</option>
                    <option>福建</option>
                    <option>江西</option>
                    <option>安徽</option>
                    <option>贵州</option>
                    <option>山西</option>
                    <option>河北</option>
                    <option>辽宁</option>
                    <option>吉林</option>
                    <option>黑龙江</option>
                    <option>天津</option>
                    <option>内蒙古</option>
                    <option>新疆</option>
                    <option>甘肃</option>
                    <option>青海</option>
                    <option>宁夏</option>
                    <option>西藏</option>
                    <option>海南</option>
                    <option>香港</option>
                    <option>澳门</option>
                    <option>台湾</option>
                  </select>
                </div>

                <div class="flex items-center gap-2">
                  <span class="text-dark-100">时间:</span>
                  <select class="bg-dark-300 border border-dark-200 rounded-lg py-1.5 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <option>近7天</option>
                    <option>近30天</option>
                    <option>近90天</option>
                    <option>近1年</option>
                    <option>全部</option>
                  </select>
                </div>
              </div>

              <div class="flex items-center gap-3">
                <button class="bg-dark-300 hover:bg-dark-300/80 text-dark-100 py-1.5 px-3 rounded-lg transition-colors">
                  <i class="fa fa-filter mr-1"></i> 高级筛选
                </button>
                <button class="bg-primary hover:bg-primary/90 text-white py-1.5 px-3 rounded-lg transition-colors flex items-center">
                  <i class="fa fa-refresh mr-1"></i> 刷新数据
                </button>
              </div>
            </div>
          </div>
          <!-- 全局地图 - 优化版 -->
<div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg mb-8 transition-all duration-300">
  <div class="p-4 border-b border-dark-300 flex justify-between items-center">
    <h3 class="font-semibold text-lg">全国舆情热度分布</h3>
    <div class="flex items-center gap-2">
      <button id="map-expand-btn" class="text-dark-100 hover:text-white transition-colors">
        <i class="fa fa-expand"></i>
      </button>
      <button class="text-dark-100 hover:text-white transition-colors">
        <i class="fa fa-download"></i>
      </button>
    </div>
  </div>
  <div class="h-[calc(100%-60px)] relative" style="padding-top: 50%;">
    <!-- 嵌入全国地图可视化 - 使用相对定位和padding保持比例 -->
    <iframe src="111.html" class="absolute inset-0 w-full h-full border-0"></iframe>

    <!-- 热点标记 - 优化位置和动画 -->
    <div class="absolute top-[32%] left-[28%] group">
      
    </div>

    <div class="absolute top-[45%] left-[65%] group">
      
    </div>
  </div>
</div>

<!-- 可放大的网格区域 -->
<div id="expandable-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6 cursor-zoom-in">
  <!-- 趋势图表 -->
  <div class="bg-dark-400 rounded-xl p-5 border border-dark-300 hover:shadow-lg transition-all duration-300">
    <h3 class="text-sm font-medium mb-4">舆情趋势变化</h3>
    <div class="h-64">
      <canvas id="trend-chart"></canvas>
    </div>
  </div>

  <!-- 分布图表 -->
  <div class="bg-dark-400 rounded-xl p-5 border border-dark-300 hover:shadow-lg transition-all duration-300">
    <h3 class="text-sm font-medium mb-4">情感倾向分布</h3>
    <div class="h-64">
      <canvas id="distribution-chart"></canvas>
    </div>
  </div>
</div>

<!-- 放大查看模态框 -->
<div id="fullscreen-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 opacity-0 pointer-events-none transition-opacity duration-300">
  <div class="relative w-full max-w-[96vw] max-h-[96vh] bg-dark-400 rounded-xl overflow-hidden shadow-2xl transform transition-transform duration-300 scale-95">
    <div class="p-4 border-b border-dark-300 flex justify-between items-center">
      <h3 id="modal-title" class="font-semibold text-lg">图表详情</h3>
      <button id="close-modal" class="text-dark-100 hover:text-white transition-colors p-2">
        <i class="fa fa-times"></i>
      </button>
    </div>
    <div id="modal-content" class="p-6 h-[calc(100%-60px)] overflow-auto">
      <!-- 放大后的内容将在这里显示 -->
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 初始化图表
let trendChart, distributionChart;

// AI情感分析功能
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('ai-sentiment-input');
  const btn = document.getElementById('ai-sentiment-btn');
  const resultDiv = document.getElementById('ai-sentiment-result');
  if (btn) {
    btn.addEventListener('click', async function() {
      const text = input.value.trim();
      if (!text) {
        resultDiv.innerHTML = '<span class="text-warning">请输入要分析的文本</span>';
        return;
      }
      resultDiv.innerHTML = '<span class="text-dark-100">分析中...</span>';
      try {
        const res = await fetch('http://127.0.0.1:5000/sentiment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        if (!res.ok) throw new Error('服务异常');
        const data = await res.json();
        let label = data.label === 'positive' ? '积极' : (data.label === 'negative' ? '消极' : data.label);
        let score = (data.score * 100).toFixed(1) + '%';
        resultDiv.innerHTML = `<span class="font-bold">情感判断：</span><span class="text-primary font-semibold">${label}</span> <span class="ml-2 text-dark-100">置信度：${score}</span>`;
      } catch (e) {
        resultDiv.innerHTML = '<span class="text-danger">分析失败，请检查后端服务</span>';
      }
    });
  }
});

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
  // 初始化趋势图表
  const trendCtx = document.getElementById('trend-chart').getContext('2d');
  trendChart = new Chart(trendCtx, {
    type: 'line',
    data: {
      labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月'],
      datasets: [{
        label: '舆情数量',
        data: [1200, 1900, 1700, 2100, 2500, 2300, 2800],
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.05)' } },
        x: { grid: { color: 'rgba(255, 255, 255, 0.05)' } }
      }
    }
  });

  // 初始化分布图表
  const distCtx = document.getElementById('distribution-chart').getContext('2d');
  distributionChart = new Chart(distCtx, {
    type: 'doughnut',
    data: {
      labels: ['消极', '中立', '积极'],
      datasets: [{
        data: [45, 30, 25],
        backgroundColor: ['#44dbef', 'rgba(135,95,202,0.9)', '#6cd6b3'],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // 绑定网格区域点击放大事件
  const expandableGrid = document.getElementById('expandable-grid');
  const fullscreenModal = document.getElementById('fullscreen-modal');
  const modalContent = document.getElementById('modal-content');
  const modalTitle = document.getElementById('modal-title');
  const closeModal = document.getElementById('close-modal');

  // 地图全屏按钮
  const mapExpandBtn = document.getElementById('map-expand-btn');

  // 点击网格区域放大
  expandableGrid.addEventListener('click', function() {
    // 克隆网格内容到模态框
    modalTitle.textContent = '舆情分析图表详情';
    modalContent.innerHTML = '';
    modalContent.appendChild(this.cloneNode(true));

    // 显示模态框并添加动画
    fullscreenModal.classList.remove('opacity-0', 'pointer-events-none');
    fullscreenModal.querySelector('div').classList.remove('scale-95');
    fullscreenModal.querySelector('div').classList.add('scale-100');

    // 阻止背景滚动
    document.body.style.overflow = 'hidden';
  });

  // 地图放大功能
  mapExpandBtn.addEventListener('click', function() {
    modalTitle.textContent = '全国舆情热度分布 - 全屏查看';
    // 创建地图iframe的放大版本
    modalContent.innerHTML = `
      <div style="padding-top: 56.25%; position: relative;">
        <iframe src="111.html" class="absolute inset-0 w-full h-full border-0"></iframe>
      </div>
    `;

    // 显示模态框并添加动画
    fullscreenModal.classList.remove('opacity-0', 'pointer-events-none');
    fullscreenModal.querySelector('div').classList.remove('scale-95');
    fullscreenModal.querySelector('div').classList.add('scale-100');

    // 阻止背景滚动
    document.body.style.overflow = 'hidden';
  });

  // 关闭模态框
  closeModal.addEventListener('click', function() {
    fullscreenModal.classList.add('opacity-0', 'pointer-events-none');
    fullscreenModal.querySelector('div').classList.remove('scale-100');
    fullscreenModal.querySelector('div').classList.add('scale-95');

    // 恢复背景滚动
    document.body.style.overflow = '';
  });

  // 点击模态框背景关闭
  fullscreenModal.addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal.click();
    }
  });

  // 按ESC键关闭
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && !fullscreenModal.classList.contains('pointer-events-none')) {
      closeModal.click();
    }
  });
});
</script>


          <!-- 热点文本 -->
          <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg mb-6">
            <div class="p-4 border-b border-dark-300 flex justify-between items-center">
              <h3 class="font-semibold text-lg">最新热点文本</h3>
              <div class="flex items-center gap-2">
                <button class="text-dark-100 hover:text-white transition-colors">
                  <i class="fa fa-refresh"></i>
                </button>
              </div>
            </div>
            <div class="p-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-dark-300/50 rounded-lg p-3 hover:bg-dark-300/70 transition-colors cursor-pointer">
                  <div class="flex items-center mb-2">
                    <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center mr-2">
                      <i class="fa fa-newspaper-o text-primary"></i>
                    </div>
                    <div>
                      <h4 class="font-medium text-sm">人民日报：中国发布《2025年应对气候变化国家报告》</h4>
                      <p class="text-xs text-dark-100">2025-07-15 · 政策讨论</p>
                    </div>
                  </div>
                  <p class="text-sm text-dark-100">报告显示，中国在过去五年中碳排放强度下降了18%，可再生能源占比提高至42%，森林碳汇能力显著增强...</p>
                  <div class="flex justify-between items-center mt-2">
                    <div class="flex items-center">
                      <span class="bg-primary/10 text-primary text-xs px-2 py-1 rounded">碳中和</span>
                      <span class="bg-secondary/10 text-secondary text-xs px-2 py-1 rounded ml-1">可再生能源</span>
                    </div>
                    <div class="flex items-center gap-2 text-dark-100 text-xs">
                      <span><i class="fa fa-eye mr-1"></i> 2.4k</span>
                      <span><i class="fa fa-comment mr-1"></i> 328</span>
                    </div>
                  </div>
                </div>

                <div class="bg-dark-300/50 rounded-lg p-3 hover:bg-dark-300/70 transition-colors cursor-pointer">
                  <div class="flex items-center mb-2">
                    <div class="w-8 h-8 rounded-full bg-danger/20 flex items-center justify-center mr-2">
                      <i class="fa fa-twitter text-danger"></i>
                    </div>
                    <div>
              <h4 class="font-medium text-sm">联合国秘书长：全国气候危机已达临界点，需立即行动</h4>
                      <p class="text-xs text-dark-100">2025-07-14 · 国际合作</p>
                    </div>
                  </div>
                  <p class="text-sm text-dark-100">在最新的联合国气候峰会上，秘书长强调全国气温上升速度超过预期，呼吁各地加强合作，加大减排力度...</p>
                  <div class="flex justify-between items-center mt-2">
                    <div class="flex items-center">
                      <span class="bg-danger/10 text-danger text-xs px-2 py-1 rounded">气候峰会</span>
                      <span class="bg-warning/10 text-warning text-xs px-2 py-1 rounded ml-1">减排目标</span>
                    </div>
                    <div class="flex items-center gap-2 text-dark-100 text-xs">
                      <span><i class="fa fa-eye mr-1"></i> 5.7k</span>
                      <span><i class="fa fa-comment mr-1"></i> 842</span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- ...existing code... -->
            </div>
          </div>
        </div>

        <!-- 2. 时间趋势页面 -->
        <div id="trends-page" class="page-content hidden">
          <div class="mb-6">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">舆情时间趋势分析</h2>
            <p class="text-dark-100 mt-1">分析气候变化相关舆情随时间的发展趋势与规律</p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- 优化后的筛选栏：分组折叠/吸底按钮/高亮选中态/更大佬风格 -->
<div class="lg:col-span-1 bg-dark-400 rounded-xl p-4 border border-dark-300 flex flex-col min-h-[580px]">
  <h3 class="font-semibold mb-4 text-white text-lg">筛选条件</h3>
  <div class="flex-1 space-y-4">
    <!-- 时间范围 (单选) -->
    <div>
      <label class="text-dark-100 text-sm block mb-2">时间范围</label>
      <div class="flex flex-wrap gap-2">
        <button class="bg-primary/80 text-white text-xs px-3 py-1 rounded-full shadow ring-2 ring-primary/30 font-bold transition-colors hover:bg-primary" aria-pressed="true">近1周</button>
        <button class="bg-dark-300 text-dark-100 text-xs px-3 py-1 rounded-full hover:bg-primary/30 transition-colors">近1月</button>
        <button class="bg-dark-300 text-dark-100 text-xs px-3 py-1 rounded-full hover:bg-primary/30 transition-colors">近3月</button>
        <button class="bg-dark-300 text-dark-100 text-xs px-3 py-1 rounded-full hover:bg-primary/30 transition-colors">近1年</button>
      </div>
    </div>
    <!-- 话题类别 (多选) -->
    <div>
      <label class="text-dark-100 text-sm block mb-2">话题类别</label>
      <div class="space-y-2">
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-primary rounded focus:ring-primary/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-white">政策讨论</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-primary rounded focus:ring-primary/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-white">影响评估</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-primary rounded focus:ring-primary/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-white">应对措施</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-primary rounded focus:ring-primary/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-white">科学研究</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-primary rounded focus:ring-primary/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-white">国际合作</span>
        </label>
      </div>
    </div>
    <!-- 地区筛选 (下拉+搜索) -->
    <div>
      <label class="text-dark-100 text-sm block mb-2">地区筛选</label>
      <select class="bg-dark-300 border border-dark-200 text-white rounded-lg py-2 px-3 w-full focus:outline-none focus:ring-2 focus:ring-primary/50">
        <option>全国</option>
        <option>北京</option>
        <option>上海</option>
        <option>广东</option>
        <option>江苏</option>
        <option>山东</option>
        <option>浙江</option>
        <option>四川</option>
        <option>河南</option>
        <option>湖北</option>
        <option>湖南</option>
        <option>陕西</option>
        <option>云南</option>
        <option>重庆</option>
        <option>广西</option>
        <option>福建</option>
        <option>江西</option>
        <option>安徽</option>
        <option>贵州</option>
        <option>山西</option>
        <option>河北</option>
        <option>辽宁</option>
        <option>吉林</option>
        <option>黑龙江</option>
        <option>天津</option>
        <option>内蒙古</option>
        <option>新疆</option>
        <option>甘肃</option>
        <option>青海</option>
        <option>宁夏</option>
        <option>西藏</option>
        <option>海南</option>
        <option>香港</option>
        <option>澳门</option>
        <option>台湾</option>
      </select>
    </div>
    <!-- 情感倾向 (多选) -->
    <div>
      <label class="text-dark-100 text-sm block mb-2">情感倾向</label>
      <div class="space-y-2">
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-danger rounded focus:ring-danger/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-red-400">消极</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-warning rounded focus:ring-warning/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-yellow-300">中立</span>
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" checked class="accent-success rounded focus:ring-success/50 bg-dark-300 border-dark-200">
          <span class="ml-2 text-sm text-green-400">积极</span>
        </label>
      </div>
    </div>
  </div>
  <!-- 吸底应用筛选按钮 -->
  <button class="w-full bg-gradient-to-r from-primary to-indigo-600 hover:from-indigo-500 hover:to-primary text-white py-2 rounded-lg font-bold mt-6 shadow transition-colors">
    <span class="inline-flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" /></svg>
      应用筛选
    </span>
  </button>
</div>

            <!-- 右侧时间趋势图 -->
            <div class="lg:col-span-3 bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
              <div class="p-4 border-b border-dark-300 flex justify-between items-center">
                <h3 class="font-semibold text-lg">舆情热度时间趋势</h3>
                <div class="flex items-center gap-2">
                  <div class="relative">
                    <select class="bg-dark-300 border border-dark-200 rounded-lg py-1 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                      <option>按日</option>
                      <option>按周</option>
                      <option>按月</option>
                    </select>
                  </div>
                  <button class="text-dark-100 hover:text-white transition-colors">
                    <i class="fa fa-expand"></i>
                  </button>
                  <button class="text-dark-100 hover:text-white transition-colors">
                    <i class="fa fa-download"></i>
                  </button>
                </div>
              </div>
              <div class="p-4 h-[650px]">
                <!-- 嵌入时间趋势可视化 -->
                <iframe src="舆情热度时间趋势图2.html" class="w-full h-full border-0"></iframe>
              </div>
            </div>
          </div>

          <!-- 热点词云 -->
          <div class="mt-6 bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
            <div class="p-4 border-b border-dark-300 flex justify-between items-center">
              <h3 class="font-semibold text-lg">热点词云随时间变化</h3>
              <div class="flex items-center gap-2">
                <button class="text-dark-100 hover:text-white transition-colors">
                  <i class="fa fa-expand"></i>
                </button>
                <button class="text-dark-100 hover:text-white transition-colors">
                  <i class="fa fa-download"></i>
                </button>
              </div>
            </div>
            <div class="p-4 h-[500px]">
              <!-- 嵌入词云可视化 -->
              <iframe src="cyber_dynamic_wordcloud.html" class="w-full h-full border-0"></iframe>
            </div>
          </div>
        </div>

        <!-- 3. 主题分析页面 -->

<div id="themes-page" class="page-content hidden">

  <div class="mb-6">
    <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">主题与情感分析</h2>
    <p class="text-dark-100 mt-1">深入分析气候变化相关舆情的主题分布与情感倾向</p>
  </div>

  <!-- AI情感分析区块 -->
<div class="mb-6 bg-dark-300/40 rounded-lg p-5">
  <h4 class="font-semibold text-base mb-3 flex items-center"><i class="fa fa-magic text-primary mr-2"></i>AI情感分析</h4>
  <div class="flex flex-col md:flex-row gap-3 items-start md:items-end">
    <input id="ai-sentiment-input" type="text" placeholder="输入要分析的文本..." class="flex-1 bg-dark-300 border border-dark-200 rounded-lg py-2 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50" />
    <button id="ai-sentiment-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center"><i class="fa fa-rocket mr-1"></i>分析</button>
  </div>
  <div id="ai-result" style="margin-top:10px;color:red;"></div>
  <script>
    document.getElementById('ai-sentiment-btn').onclick = analyzeSentiment;
    async function analyzeSentiment() {
      const text = document.getElementById('ai-sentiment-input').value;
      if (!text) {
        alert("请输入要分析的文本！");
        return;
      }
      try {
        const resp = await fetch('/api/ai_sentiment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        const result = await resp.json();
        if (result.success) {
          document.getElementById('ai-result').innerText = 
            `分析成功！情感倾向：${result.sentiment}，分值：${result.score}`;
        } else {
          document.getElementById('ai-result').innerText = 
            `分析失败：${result.msg}`;
        }
      } catch (e) {
        document.getElementById('ai-result').innerText = "请求失败，请检查服务器。";
      }
    }
  </script>
</div>

  <!-- 上方：话题分类占比堆叠图 -->
  <div class="mb-6 bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
    <div class="p-4 border-b border-dark-300 flex justify-between items-center">
      <h3 class="font-semibold text-lg">话题分类占比</h3>
      <div class="flex items-center gap-3">
        <div class="flex items-center border border-dark-200 rounded-lg overflow-hidden">
          <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                  onclick="resizeChart('stacked-chart', 0.9)">
            <i class="fa fa-search-minus"></i>
          </button>
          <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                  onclick="resetChartSize('stacked-chart')">
            <i class="fa fa-compress"></i>
          </button>
          <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                  onclick="resizeChart('stacked-chart', 1.1)">
            <i class="fa fa-search-plus"></i>
          </button>
        </div>
        <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full"
                onclick="openChartModal('堆叠图4.html', '话题分类占比')" title="全屏查看">
          <i class="fa fa-expand"></i>
        </button>
        <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full"
                title="下载图表">
          <i class="fa fa-download"></i>
        </button>
      </div>
    </div>
    <div class="p-4 relative">
      <iframe id="stacked-chart" src="堆叠图4.html" class="w-full h-[500px] border-0 transition-all duration-300"
              title="话题分类占比堆叠图"></iframe>
    </div>
  </div>

  <!-- 图表与主题详情容器 - 使用适当的间距和布局 -->
  <div class="space-y-8">
    <!-- 下方：情感倾向分布图和饼状图依次排列 -->
    <div class="flex flex-col gap-6">
      <!-- 情感倾向分布图 -->
      <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
        <div class="p-4 border-b border-dark-300 flex justify-between items-center">
          <h3 class="font-semibold text-lg">情感倾向分布</h3>
          <div class="flex items-center gap-3">
            <div class="flex items-center border border-dark-200 rounded-lg overflow-hidden">
              <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                      onclick="resizeChart('sentiment-chart', 0.9)">
                <i class="fa fa-search-minus"></i>
              </button>
              <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                      onclick="resetChartSize('sentiment-chart')">
                <i class="fa fa-compress"></i>
              </button>
              <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                      onclick="resizeChart('sentiment-chart', 1.1)">
                <i class="fa fa-search-plus"></i>
              </button>
            </div>
            <div class="relative">
              <select class="bg-dark-300 border border-dark-200 rounded-lg py-1 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                <option>按地区</option>
                <option>按话题</option>
                <option>按时间</option>
              </select>
            </div>
            <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full"
                    onclick="openChartModal('情感5.html', '情感倾向分布')" title="全屏查看">
              <i class="fa fa-expand"></i>
            </button>
            <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full"
                    title="下载图表">
              <i class="fa fa-download"></i>
            </button>
          </div>
        </div>
        <div class="p-4 relative">
          <iframe id="sentiment-chart" src="情感5.html" class="w-full h-[440px] border-0 transition-all duration-300"
                  title="情感倾向分布图"></iframe>
        </div>
      </div>

      <!-- 饼状图 -->
      <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
        <div class="p-4 border-b border-dark-300 flex justify-between items-center">
          <h3 class="font-semibold text-lg">气候变化主题分布</h3>
          <div class="flex items-center gap-3">
            <div class="flex items-center border border-dark-200 rounded-lg overflow-hidden">
              <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                      onclick="resizeChart('pie-chart', 0.9)">
                <i class="fa fa-search-minus"></i>
              </button>
              <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                      onclick="resetChartSize('pie-chart')">
                <i class="fa fa-compress"></i>
              </button>
              <button class="bg-dark-300 text-dark-100 hover:text-white px-2 py-1 transition-colors"
                      onclick="resizeChart('pie-chart', 1.1)">
                <i class="fa fa-search-plus"></i>
              </button>
            </div>
            <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full"
                    onclick="openChartModal('饼图3.html', '气候变化主题分布')" title="全屏查看">
              <i class="fa fa-expand"></i>
            </button>
            <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full"
                    title="下载图表">
              <i class="fa fa-download"></i>
            </button>
          </div>
        </div>
        <div class="p-4 relative">
          <iframe id="pie-chart" src="饼图3.html" class="w-full h-[440px] border-0 transition-all duration-300"
                  title="气候变化主题分布饼图"></iframe>
        </div>
      </div>
    </div>

    <!-- 主题详情分析 - 移至单独区块并增加顶部间距 -->
    <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg transform transition-all duration-300 hover:shadow-xl">
      <div class="p-4 border-b border-dark-300 flex flex-wrap justify-between items-center gap-3">
        <h3 class="font-semibold text-lg flex items-center">
          <i class="fa fa-fire text-warning mr-2"></i>热门主题详情
        </h3>
        <div class="flex items-center gap-3">
          <div class="relative">
            <select class="bg-dark-300 border border-dark-200 rounded-lg py-1 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-200">
              <option>按热度排序</option>
              <option>按增长速度</option>
              <option>按讨论时长</option>
            </select>
          </div>
          <button class="text-dark-100 hover:text-white transition-colors hover:bg-dark-300/50 p-1.5 rounded-full" title="刷新数据">
            <i class="fa fa-refresh"></i>
          </button>
        </div>
      </div>
      <div class="p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- 主题卡片 1 -->
          <div class="bg-dark-300/20 rounded-xl p-4 border border-dark-300 hover:border-primary/50 transition-all duration-300 hover:shadow-lg hover:shadow-primary/5 hover:-translate-y-1 group">
            <div class="flex items-center mb-3">
              <span class="bg-primary/10 text-primary text-xs px-2.5 py-1 rounded-full font-medium">
                #碳中和
              </span>
              <span class="ml-auto bg-dark-300/50 text-white text-xs px-2 py-0.5 rounded-full flex items-center">
                <i class="fa fa-bolt text-primary mr-1"></i>热度: 92
              </span>
            </div>
            <p class="text-sm text-dark-100 mb-3 leading-relaxed">
              全国各地碳中和政策进展与实施效果讨论，包括减排目标、政策工具和实施路径等。
            </p>
            <div class="mb-3">
              <div class="flex justify-between text-xs text-dark-100 mb-1.5">
                <span>情感分布</span>
                <span class="font-medium">积极32% 中立38% 消极30%</span>
              </div>
              <div class="w-full bg-dark-300/50 rounded-full h-2.5 overflow-hidden">
                <div class="bg-success h-full rounded-l-full transition-all duration-1000 group-hover:width-[32%]" style="width: 32%"></div>
                <div class="bg-warning h-full transition-all duration-1000 group-hover:width-[38%]" style="width: 38%"></div>
                <div class="bg-danger h-full rounded-r-full transition-all duration-1000 group-hover:width-[30%]" style="width: 30%"></div>
              </div>
            </div>
            <div class="flex justify-between items-center text-xs text-dark-100 pt-1 border-t border-dark-300/50">
              <span class="flex items-center hover:text-white transition-colors">
                <i class="fa fa-comment mr-1.5"></i> 32.4k 讨论
              </span>
              <span class="flex items-center text-success font-medium">
                <i class="fa fa-arrow-up mr-1.5"></i> 12.5%
              </span>
            </div>
          </div>

          <!-- 主题卡片 2 -->
          <div class="bg-dark-300/20 rounded-xl p-4 border border-dark-300 hover:border-warning/50 transition-all duration-300 hover:shadow-lg hover:shadow-warning/5 hover:-translate-y-1 group">
            <div class="flex items-center mb-3">
              <span class="bg-warning/10 text-warning text-xs px-2.5 py-1 rounded-full font-medium">
                #极端高温
              </span>
              <span class="ml-auto bg-dark-300/50 text-white text-xs px-2 py-0.5 rounded-full flex items-center">
                <i class="fa fa-bolt text-warning mr-1"></i>热度: 87
              </span>
            </div>
            <p class="text-sm text-dark-100 mb-3 leading-relaxed">
              全国范围内极端高温事件的报道与讨论，包括对生态系统、人类健康和社会经济的影响。
            </p>
            <div class="mb-3">
              <div class="flex justify-between text-xs text-dark-100 mb-1.5">
                <span>情感分布</span>
                <span class="font-medium">积极15% 中立25% 消极60%</span>
              </div>
              <div class="w-full bg-dark-300/50 rounded-full h-2.5 overflow-hidden">
                <div class="bg-success h-full rounded-l-full transition-all duration-1000 group-hover:width-[15%]" style="width: 15%"></div>
                <div class="bg-warning h-full transition-all duration-1000 group-hover:width-[25%]" style="width: 25%"></div>
                <div class="bg-danger h-full rounded-r-full transition-all duration-1000 group-hover:width-[60%]" style="width: 60%"></div>
              </div>
            </div>
            <div class="flex justify-between items-center text-xs text-dark-100 pt-1 border-t border-dark-300/50">
              <span class="flex items-center hover:text-white transition-colors">
                <i class="fa fa-comment mr-1.5"></i> 28.7k 讨论
              </span>
              <span class="flex items-center text-success font-medium">
                <i class="fa fa-arrow-up mr-1.5"></i> 23.2%
              </span>
            </div>
          </div>

          <!-- 主题卡片 3 -->
          <div class="bg-dark-300/20 rounded-xl p-4 border border-dark-300 hover:border-accent/50 transition-all duration-300 hover:shadow-lg hover:shadow-accent/5 hover:-translate-y-1 group">
            <div class="flex items-center mb-3">
              <span class="bg-accent/10 text-accent text-xs px-2.5 py-1 rounded-full font-medium">
                #碳关税
              </span>
              <span class="ml-auto bg-dark-300/50 text-white text-xs px-2 py-0.5 rounded-full flex items-center">
                <i class="fa fa-bolt text-accent mr-1"></i>热度: 79
              </span>
            </div>
            <p class="text-sm text-dark-100 mb-3 leading-relaxed">
              关于碳边境调节机制(CBAM)等碳关税政策的讨论，包括国际贸易影响和公平性争议。
            </p>
            <div class="mb-3">
              <div class="flex justify-between text-xs text-dark-100 mb-1.5">
                <span>情感分布</span>
                <span class="font-medium">积极20% 中立25% 消极55%</span>
              </div>
              <div class="w-full bg-dark-300/50 rounded-full h-2.5 overflow-hidden">
                <div class="bg-success h-full rounded-l-full transition-all duration-1000 group-hover:width-[20%]" style="width: 20%"></div>
                <div class="bg-warning h-full transition-all duration-1000 group-hover:width-[25%]" style="width: 25%"></div>
                <div class="bg-danger h-full rounded-r-full transition-all duration-1000 group-hover:width-[55%]" style="width: 55%"></div>
              </div>
            </div>
            <div class="flex justify-between items-center text-xs text-dark-100 pt-1 border-t border-dark-300/50">
              <span class="flex items-center hover:text-white transition-colors">
                <i class="fa fa-comment mr-1.5"></i> 21.3k 讨论
              </span>
              <span class="flex items-center text-success font-medium">
                <i class="fa fa-arrow-up mr-1.5"></i> 8.7%
              </span>
            </div>
          </div>
        </div>

        <!-- 查看更多按钮 -->
        <div class="mt-5 text-center">
          <button class="inline-flex items-center px-4 py-2 bg-dark-300/30 hover:bg-dark-300/50 text-white text-sm rounded-lg transition-all duration-200">
            查看更多热门主题
            <i class="fa fa-chevron-right ml-2 text-xs"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 图表放大查看模态框 - 调整为更大尺寸 -->

<div id="chart-modal" class="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-0 m-0 opacity-0 pointer-events-none transition-all duration-300">
  <div class="bg-dark-400 rounded-xl w-[96vw] h-[96vh] max-w-none max-h-none flex flex-col">
    <div class="p-3 border-b border-dark-300 flex justify-between items-center bg-dark-400/95 backdrop-blur-sm z-10">
      <h3 id="modal-title" class="font-semibold text-lg"></h3>
      <div class="flex items-center gap-2">
        <button class="text-dark-100 hover:text-white transition-colors p-1.5 rounded-full"
                onclick="resizeModalChart(0.9)" title="缩小">
          <i class="fa fa-search-minus"></i>
        </button>
        <button class="text-dark-100 hover:text-white transition-colors p-1.5 rounded-full"
                onclick="resetModalChart()" title="重置大小">
          <i class="fa fa-compress"></i>
        </button>
        <button class="text-dark-100 hover:text-white transition-colors p-1.5 rounded-full"
                onclick="resizeModalChart(1.1)" title="放大">
          <i class="fa fa-search-plus"></i>
        </button>
        <button id="close-modal" class="text-dark-100 hover:text-white transition-colors p-1.5 rounded-full"
                title="关闭">
          <i class="fa fa-times"></i>
        </button>
      </div>
    </div>
    <div class="flex-grow p-0 relative">
      <iframe id="modal-iframe" src="" class="w-full h-full border-0 transition-all duration-300"
              title="全屏图表查看"></iframe>
    </div>
  </div>
</div>

<script>
// 存储图表原始尺寸
const originalSizes = {
  'stacked-chart': 500,
  'sentiment-chart': 440,
  'pie-chart': 440,
  'modal-iframe': 1 // 模态框内图表的缩放比例
};

// 调整图表大小
function resizeChart(chartId, scaleFactor) {
  const chart = document.getElementById(chartId);
  if (chart) {
    const currentHeight = chart.offsetHeight;
    // 限制最小和最大高度，防止过度缩放
    const newHeight = Math.max(200, Math.min(800, currentHeight * scaleFactor));
    chart.style.height = newHeight + 'px';
  }
}

// 重置图表大小
function resetChartSize(chartId) {
  const chart = document.getElementById(chartId);
  if (chart) {
    chart.style.height = originalSizes[chartId] + 'px';
  }
}

// 调整模态框内图表大小 - 允许更大的缩放范围
function resizeModalChart(scaleFactor) {
  const modalIframe = document.getElementById('modal-iframe');
  originalSizes['modal-iframe'] *= scaleFactor;
  // 进一步扩大缩放范围
  originalSizes['modal-iframe'] = Math.max(0.3, Math.min(2.5, originalSizes['modal-iframe']));
  modalIframe.style.transform = `scale(${originalSizes['modal-iframe']})`;
  modalIframe.style.transformOrigin = 'center center';
}

// 重置模态框内图表大小
function resetModalChart() {
  const modalIframe = document.getElementById('modal-iframe');
  originalSizes['modal-iframe'] = 1;
  modalIframe.style.transform = 'scale(1)';
}

// 打开图表模态框 - 新增窗口最大化效果
function openChartModal(src, title) {
  const modal = document.getElementById('chart-modal');
  const modalIframe = document.getElementById('modal-iframe');
  const modalTitle = document.getElementById('modal-title');

  modalTitle.textContent = title;
  modalIframe.src = src;
  resetModalChart(); // 重置缩放状态

  // 先显示模态框，再添加一个小延迟来触发更流畅的动画
  modal.classList.remove('opacity-0', 'pointer-events-none');
  document.body.style.overflow = 'hidden';

  // 可选：添加一个微小的缩放动画，增强全屏感
  setTimeout(() => {
    modal.querySelector('div').classList.add('animate-pulse');
    setTimeout(() => {
      modal.querySelector('div').classList.remove('animate-pulse');
    }, 300);
  }, 100);
}

// 关闭模态框
document.getElementById('close-modal').addEventListener('click', function() {
  const modal = document.getElementById('chart-modal');
  modal.classList.add('opacity-0', 'pointer-events-none');
  document.body.style.overflow = '';
  setTimeout(() => {
    document.getElementById('modal-iframe').src = '';
  }, 300);
});

// 点击模态框背景关闭
document.getElementById('chart-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    document.getElementById('close-modal').click();
  }
});

// ESC键关闭模态框
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && !document.getElementById('chart-modal').classList.contains('pointer-events-none')) {
    document.getElementById('close-modal').click();
  }
});
</script>


</script>


        <section id="alerts-page" class="page-content bg-gradient-to-b from-slate-900 to-slate-800 min-h-screen transition-all duration-500">
  <!-- 顶部导航与标题区 -->
  <div class="container mx-auto px-4 py-6">
    <div class="mb-8 relative overflow-hidden rounded-xl">
      <div class="absolute inset-0 bg-gradient-to-r from-blue-900/20 to-indigo-900/20"></div>
      <div class="relative z-10 p-6 backdrop-blur-sm bg-white/5 border border-white/10 rounded-xl">
        <h2 class="text-[clamp(1.75rem,4vw,2.5rem)] font-bold text-white tracking-tight">全国气候变化预警中心</h2>
        <p class="text-slate-300 mt-2 max-w-3xl">
          基于多源数据融合的智能预警系统，实时监测全国气候变化趋势，提供精准预测与风险评估
        </p>
        
        <!-- 关键指标卡片 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
          <div class="bg-slate-800/80 border border-slate-700 rounded-lg p-4 backdrop-blur-sm transform hover:translate-y-[-4px] transition-all duration-300">
            <div class="flex justify-between items-start">
              <div>
                <p class="text-slate-400 text-sm">全国平均温度</p>
                <h3 class="text-2xl font-bold text-white mt-1">16.8°C</h3>
              </div>
              <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
                <i class="fa fa-thermometer-full text-red-400"></i>
              </div>
            </div>
            <p class="text-red-400 text-xs mt-2 flex items-center">
              <i class="fa fa-arrow-up mr-1"></i>较常年同期上升0.7°C
            </p>
          </div>
          
          <div class="bg-slate-800/80 border border-slate-700 rounded-lg p-4 backdrop-blur-sm transform hover:translate-y-[-4px] transition-all duration-300">
            <div class="flex justify-between items-start">
              <div>
                <p class="text-slate-400 text-sm">活跃极端事件</p>
                <h3 class="text-2xl font-bold text-white mt-1">8</h3>
              </div>
              <div class="w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center">
                <i class="fa fa-exclamation-triangle text-amber-400"></i>
              </div>
            </div>
            <p class="text-amber-400 text-xs mt-2 flex items-center">
              <i class="fa fa-map-marker mr-1"></i>全国范围内监测
            </p>
          </div>
          
          <div class="bg-slate-800/80 border border-slate-700 rounded-lg p-4 backdrop-blur-sm transform hover:translate-y-[-4px] transition-all duration-300">
            <div class="flex justify-between items-start">
              <div>
                <p class="text-slate-400 text-sm">区域降水距平</p>
                <h3 class="text-2xl font-bold text-white mt-1">±23%</h3>
              </div>
              <div class="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center">
                <i class="fa fa-tint text-blue-400"></i>
              </div>
            </div>
            <p class="text-blue-400 text-xs mt-2 flex items-center">
              <i class="fa fa-area-chart mr-1"></i>空间分布不均
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- 主要内容区 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- 左侧：气候趋势与预警 -->
      <div class="lg:col-span-2 space-y-6">
        <!-- 气候趋势可视化 -->
        <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-5 backdrop-blur-sm shadow-lg">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-white font-semibold text-lg">全国气候趋势分析</h3>
            <div class="flex gap-2">
              <button class="period-btn active px-3 py-1 text-xs rounded-full bg-blue-600 text-white">近30年</button>
              <button class="period-btn px-3 py-1 text-xs rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600">近10年</button>
              <button class="period-btn px-3 py-1 text-xs rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600">近5年</button>
            </div>
          </div>
          <div class="h-80">
            <canvas id="climate-trend-chart" class="w-full h-full"></canvas>
          </div>
          <div class="grid grid-cols-3 gap-2 mt-4 text-center">
            <div class="p-2 bg-slate-700/50 rounded-lg">
              <p class="text-slate-400 text-xs">温度上升速率</p>
              <p class="text-red-400 font-semibold">+0.22°C/10年</p>
            </div>
            <div class="p-2 bg-slate-700/50 rounded-lg">
              <p class="text-slate-400 text-xs">极端降水增加</p>
              <p class="text-blue-400 font-semibold">+6.5%/ decade</p>
            </div>
            <div class="p-2 bg-slate-700/50 rounded-lg">
              <p class="text-slate-400 text-xs">高温日数变化</p>
              <p class="text-orange-400 font-semibold">+3.2天/10年</p>
            </div>
          </div>
        </div>

        <!-- 全国气候风险热力图 -->
        <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-5 backdrop-blur-sm shadow-lg">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-white font-semibold text-lg">全国气候风险热力图</h3>
            <div class="flex gap-2">
              <button class="risk-type-btn active px-3 py-1 text-xs rounded-full bg-blue-600 text-white">综合风险</button>
              <button class="risk-type-btn px-3 py-1 text-xs rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600">洪涝</button>
              <button class="risk-type-btn px-3 py-1 text-xs rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600">干旱</button>
              <button class="risk-type-btn px-3 py-1 text-xs rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600">高温</button>
            </div>
          </div>
          <div id="climate-risk-map" class="w-full h-96 rounded-lg overflow-hidden relative bg-slate-900">
            <!-- 全国地图容器 -->
            <div id="china-map-container" class="w-full h-full relative">
              <canvas id="china-map-canvas" class="w-full h-full"></canvas>
              
              <!-- 地图省份标签 -->
              <div class="absolute inset-0 pointer-events-none">
                <!-- 省份标签将由JS动态生成 -->
              </div>
            </div>
            
            <!-- 交互控制器 -->
            <div class="absolute bottom-4 left-4 bg-slate-800/80 backdrop-blur-sm border border-slate-700 rounded-lg p-2 flex flex-col gap-2">
              <button id="rotate-map" class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center hover:bg-slate-600 transition-colors">
                <i class="fa fa-refresh text-slate-300"></i>
              </button>
              <button id="zoom-in" class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center hover:bg-slate-600 transition-colors">
                <i class="fa fa-plus text-slate-300"></i>
              </button>
              <button id="zoom-out" class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center hover:bg-slate-600 transition-colors">
                <i class="fa fa-minus text-slate-300"></i>
              </button>
            </div>
            
            <!-- 风险图例 -->
            <div class="absolute bottom-4 right-4 bg-slate-800/80 backdrop-blur-sm border border-slate-700 rounded-lg p-3">
              <p class="text-white text-xs font-medium mb-2">风险等级</p>
              <div class="flex items-center gap-2 mb-1">
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span class="text-slate-300 text-xs">低风险</span>
              </div>
              <div class="flex items-center gap-2 mb-1">
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <span class="text-slate-300 text-xs">中风险</span>
              </div>
              <div class="flex items-center gap-2 mb-1">
                <div class="w-3 h-3 rounded-full bg-orange-500"></div>
                <span class="text-slate-300 text-xs">高风险</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <span class="text-slate-300 text-xs">极高风险</span>
              </div>
            </div>
          </div>
          
          <div id="map-info-panel" class="mt-4 p-3 bg-slate-700/50 rounded-lg border border-slate-600">
            <p class="text-slate-300 text-sm"><span class="text-blue-400">点击地图上的省份</span> 查看详细气候风险分析</p>
          </div>
        </div>
      </div>

      <!-- 右侧：预警信息与分析工具 -->
      <div class="space-y-6">
        <!-- 活跃预警 -->
        <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-5 backdrop-blur-sm shadow-lg">
          <h3 class="text-white font-semibold text-lg mb-4">当前活跃预警</h3>
          
          <div class="space-y-4">
            <!-- 高优先级预警 -->
            <div class="p-4 bg-red-900/20 border border-red-800/30 rounded-lg border-l-4 border-red-500 transform hover:translate-x-1 transition-transform cursor-pointer alert-item" data-alert-id="1">
              <div class="flex justify-between">
                <span class="px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full">极端高温</span>
                <span class="text-slate-400 text-xs">12小时前发布</span>
              </div>
              <h4 class="text-white font-medium mt-2">江南地区持续高温预警</h4>
              <p class="text-slate-300 text-sm mt-1">预计未来5天温度将持续在38°C以上，部分地区可达40°C</p>
              <div class="flex justify-between items-center mt-3">
                <span class="text-red-400 text-xs font-medium">风险等级：极高</span>
                <button class="text-xs text-blue-400 hover:text-blue-300">查看详情</button>
              </div>
            </div>
            
            <!-- 中优先级预警 -->
            <div class="p-4 bg-amber-900/20 border border-amber-800/30 rounded-lg border-l-4 border-amber-500 transform hover:translate-x-1 transition-transform cursor-pointer alert-item" data-alert-id="2">
              <div class="flex justify-between">
                <span class="px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full">暴雨</span>
                <span class="text-slate-400 text-xs">3小时前发布</span>
              </div>
              <h4 class="text-white font-medium mt-2">华北地区强降雨预警</h4>
              <p class="text-slate-300 text-sm mt-1">未来24小时将出现大到暴雨，局部地区有大暴雨</p>
              <div class="flex justify-between items-center mt-3">
                <span class="text-amber-400 text-xs font-medium">风险等级：高</span>
                <button class="text-xs text-blue-400 hover:text-blue-300">查看详情</button>
              </div>
            </div>
            
            <!-- 低优先级预警 -->
            <div class="p-4 bg-blue-900/20 border border-blue-800/30 rounded-lg border-l-4 border-blue-500 transform hover:translate-x-1 transition-transform cursor-pointer alert-item" data-alert-id="3">
              <div class="flex justify-between">
                <span class="px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs rounded-full">台风</span>
                <span class="text-slate-400 text-xs">6小时前发布</span>
              </div>
              <h4 class="text-white font-medium mt-2">东南沿海台风影响预警</h4>
              <p class="text-slate-300 text-sm mt-1">台风"木兰"将影响东南沿海，带来大风和降雨</p>
              <div class="flex justify-between items-center mt-3">
                <span class="text-blue-400 text-xs font-medium">风险等级：中</span>
                <button class="text-xs text-blue-400 hover:text-blue-300">查看详情</button>
              </div>
            </div>
          </div>
          
          <button class="w-full mt-4 py-2 text-sm text-blue-400 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
            查看所有预警 <i class="fa fa-chevron-right ml-1 text-xs"></i>
          </button>
        </div>
        
        <!-- AI气候预测分析工具 -->
        <div class="bg-slate-800/60 border border-slate-700 rounded-xl p-5 backdrop-blur-sm shadow-lg">
          <h3 class="text-white font-semibold text-lg mb-4">AI气候情景预测</h3>
          
          <div class="space-y-4">
            <div>
              <label class="block text-slate-300 text-sm mb-1">预测时间范围</label>
              <select id="prediction-period" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm">
                <option value="15">未来15天</option>
                <option value="30" selected>未来30天</option>
                <option value="90">未来3个月</option>
                <option value="180">未来6个月</option>
              </select>
            </div>
            
            <div>
              <label class="block text-slate-300 text-sm mb-1">重点关注区域</label>
              <select id="focus-region" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm">
                <option value="national" selected>全国</option>
                <option value="north">华北地区</option>
                <option value="northeast">东北地区</option>
                <option value="east">华东地区</option>
                <option value="south">华南地区</option>
                <option value="central">华中地区</option>
                <option value="west">西部地区</option>
                <option value="northwest">西北地区</option>
                <option value="southwest">西南地区</option>
              </select>
            </div>
            
            <div>
              <label class="block text-slate-300 text-sm mb-1">预测要素</label>
              <div class="grid grid-cols-2 gap-2">
                <label class="flex items-center gap-2 p-2 bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-600 transition-colors">
                  <input type="checkbox" checked class="accent-blue-500">
                  <span class="text-sm text-white">温度趋势</span>
                </label>
                <label class="flex items-center gap-2 p-2 bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-600 transition-colors">
                  <input type="checkbox" checked class="accent-blue-500">
                  <span class="text-sm text-white">降水概率</span>
                </label>
                <label class="flex items-center gap-2 p-2 bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-600 transition-colors">
                  <input type="checkbox" checked class="accent-blue-500">
                  <span class="text-sm text-white">极端天气</span>
                </label>
                <label class="flex items-center gap-2 p-2 bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-600 transition-colors">
                  <input type="checkbox" class="accent-blue-500">
                  <span class="text-sm text-white">农业影响</span>
                </label>
              </div>
            </div>
            
            <button id="run-prediction" class="w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors flex items-center justify-center gap-2">
              <i class="fa fa-bolt"></i> AI智能预测分析
            </button>
          </div>
          
          <div id="prediction-results" class="mt-4 hidden">
            <div class="p-3 bg-slate-700/50 rounded-lg border border-slate-600">
              <div class="flex justify-between items-center mb-2">
                <h4 class="text-white text-sm font-medium">AI预测结果摘要</h4>
                <span class="px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full">
                  可信度: 92%
                </span>
              </div>
              
              <div class="space-y-3 mb-3">
                <div>
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-slate-300">温度趋势预测</span>
                  </div>
                  <p class="text-white text-sm text-opacity-90">
                    未来30天全国平均气温较常年偏高0.5-0.8°C，江南地区高温日数偏多
                  </p>
                </div>
                
                <div>
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-slate-300">降水概率预测</span>
                  </div>
                  <p class="text-white text-sm text-opacity-90">
                    华北、黄淮地区降水偏多2-5成，西南地区降水偏少1-3成
                  </p>
                </div>
                
                <div>
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-slate-300">极端天气预警</span>
                  </div>
                  <p class="text-amber-400 text-sm">
                    <i class="fa fa-exclamation-circle"></i> 预计15-20日华南可能出现1次台风过程
                  </p>
                </div>
              </div>
              
              <button id="show-detail-prediction" class="w-full mt-1 py-1.5 text-xs text-blue-400 bg-slate-600 hover:bg-slate-500 rounded transition-colors">
                查看详细预测报告
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 数据来源与预测模型 -->
    <div class="mt-8 bg-slate-800/60 border border-slate-700 rounded-xl p-5 backdrop-blur-sm shadow-lg">
      <h3 class="text-white font-semibold text-lg mb-4">数据来源与AI预测模型</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h4 class="text-slate-300 font-medium text-sm mb-3">全国气象数据网络</h4>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-slate-700/50 p-3 rounded-lg">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
                  <i class="fa fa-satellite text-blue-400 text-sm"></i>
                </div>
                <span class="text-white text-sm">气象卫星</span>
              </div>
              <p class="text-slate-400 text-xs">8颗在轨气象卫星实时监测</p>
            </div>
            <div class="bg-slate-700/50 p-3 rounded-lg">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                  <i class="fa fa-map-marker text-green-400 text-sm"></i>
                </div>
                <span class="text-white text-sm">地面观测网</span>
              </div>
              <p class="text-slate-400 text-xs">全国2400+气象观测站</p>
            </div>
            <div class="bg-slate-700/50 p-3 rounded-lg">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center">
                  <i class="fa fa-database text-purple-400 text-sm"></i>
                </div>
                <span class="text-white text-sm">历史资料库</span>
              </div>
              <p class="text-slate-400 text-xs">1951年至今完整气象记录</p>
            </div>
            <div class="bg-slate-700/50 p-3 rounded-lg">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center">
                  <i class="fa fa-water text-amber-400 text-sm"></i>
                </div>
                <span class="text-white text-sm">水文监测</span>
              </div>
              <p class="text-slate-400 text-xs">主要江河湖泊监测网络</p>
            </div>
          </div>
        </div>
        
        <div>
          <h4 class="text-slate-300 font-medium text-sm mb-3">智能预测模型</h4>
          <div class="bg-slate-700/50 p-3 rounded-lg h-full">
            <div class="flex items-center justify-between mb-3">
              <span class="text-white text-sm">ClimateAI 4.0 全国预测系统</span>
              <span class="px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full">实时更新</span>
            </div>
            <p class="text-slate-400 text-xs mb-3">
              基于深度学习的多变量预测模型，融合物理机制与统计学习，专门针对中国复杂气候特征优化。
            </p>
            <div class="space-y-2">
              <div>
                <div class="flex justify-between text-xs mb-1">
                  <span class="text-slate-400">短期预测准确率</span>
                  <span class="text-green-400">94%</span>
                </div>
                <div class="w-full bg-slate-600 rounded-full h-1.5">
                  <div class="bg-green-500 h-1.5 rounded-full" style="width: 94%"></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between text-xs mb-1">
                  <span class="text-slate-400">中期预测准确率</span>
                  <span class="text-blue-400">82%</span>
                </div>
                <div class="w-full bg-slate-600 rounded-full h-1.5">
                  <div class="bg-blue-500 h-1.5 rounded-full" style="width: 82%"></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between text-xs mb-1">
                  <span class="text-slate-400">极端事件预警</span>
                  <span class="text-amber-400">88%</span>
                </div>
                <div class="w-full bg-slate-600 rounded-full h-1.5">
                  <div class="bg-amber-500 h-1.5 rounded-full" style="width: 88%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 预警通知弹窗 -->
  <div id="alert-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-slate-800 border border-slate-700 rounded-xl max-w-md w-full mx-4 overflow-hidden transform scale-95 transition-transform duration-300" id="modal-content">
      <div class="bg-gradient-to-r from-red-600 to-orange-500 p-4">
        <div class="flex justify-between items-center">
          <h3 class="text-white font-bold text-lg">紧急气候预警</h3>
          <span class="px-2 py-1 bg-white/20 text-white text-xs rounded-full backdrop-blur-sm">极高优先级</span>
        </div>
      </div>
      
      <div class="p-5">
        <h4 class="text-white text-xl font-semibold mb-3">长江中下游地区持续高温</h4>
        <p class="text-slate-300 text-sm mb-4">
          监测显示，长江中下游地区将出现持续性极端高温天气，未来7天最高气温可达39-41°C，部分地区突破历史同期纪录。
        </p>
        
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">预计持续时间</p>
            <p class="text-white font-medium mt-1">7-10天</p>
          </div>
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">影响区域</p>
            <p class="text-white font-medium mt-1">江苏、安徽、湖北等</p>
          </div>
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">最高温度</p>
            <p class="text-white font-medium mt-1">39-41°C</p>
          </div>
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">预警时效</p>
            <p class="text-white font-medium mt-1">72小时</p>
          </div>
        </div>
        
        <div class="bg-amber-900/20 border border-amber-800/30 rounded-lg p-3 mb-4">
          <h5 class="text-amber-400 text-sm font-medium mb-2 flex items-center gap-1">
            <i class="fa fa-exclamation-circle"></i> 建议措施
          </h5>
          <ul class="text-slate-300 text-xs space-y-1">
            <li class="flex items-start gap-2">
              <i class="fa fa-check-circle text-amber-400 mt-0.5 text-xs"></i>
              <span>做好防暑降温工作，减少午后高温时段户外活动</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa fa-check-circle text-amber-400 mt-0.5 text-xs"></i>
              <span>加强电力调度，保障居民生活用电和农业灌溉</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa fa-check-circle text-amber-400 mt-0.5 text-xs"></i>
              <span>做好森林和城市防火工作，警惕火灾风险</span>
            </li>
          </ul>
        </div>
        
        <div class="flex gap-3">
          <button class="flex-1 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors">
            查看详细分析
          </button>
          <button id="close-alert-modal" class="flex-1 py-2.5 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded-lg transition-colors">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 省份详情弹窗 -->
  <div id="province-detail-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-slate-800 border border-slate-700 rounded-xl max-w-2xl w-full mx-4 overflow-hidden transform scale-95 transition-transform duration-300" id="province-modal-content">
      <div class="bg-gradient-to-r from-blue-600 to-indigo-500 p-4">
        <div class="flex justify-between items-center">
          <h3 class="text-white font-bold text-lg" id="province-modal-title">省份气候风险详情</h3>
          <button id="close-province-modal" class="text-white hover:text-slate-200">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="p-5">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-5">
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">当前风险等级</p>
            <p class="text-white font-medium mt-1 text-xl" id="province-risk-level">高风险</p>
          </div>
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">主要风险类型</p>
            <p class="text-white font-medium mt-1" id="province-risk-type">高温、干旱</p>
          </div>
          <div class="bg-slate-700/50 p-3 rounded-lg">
            <p class="text-slate-400 text-xs">未来15天预警</p>
            <p class="text-white font-medium mt-1" id="province-future-alert">1次高温预警</p>
          </div>
        </div>
        
        <div class="mb-5">
          <h4 class="text-white text-sm font-medium mb-3">气候状况分析</h4>
          <div class="h-48">
            <canvas id="province-chart" class="w-full h-full"></canvas>
          </div>
        </div>
        
        <div class="bg-slate-700/50 border border-slate-600 rounded-lg p-3 mb-4">
          <h5 class="text-blue-400 text-sm font-medium mb-2 flex items-center gap-1">
            <i class="fa fa-lightbulb-o"></i> AI智能分析
          </h5>
          <p class="text-slate-300 text-sm" id="province-ai-analysis">
            根据历史数据和当前趋势，该地区未来30天发生持续性高温的概率为78%，建议提前做好水资源调度和防暑降温准备。
          </p>
        </div>
        
        <div class="flex gap-3">
          <button class="flex-1 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors">
            查看完整报告
          </button>
          <button class="flex-1 py-2.5 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded-lg transition-colors" id="close-province-btn">
            返回地图
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- AI预测详情弹窗 -->
  <div id="prediction-detail-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
    <div class="bg-slate-800 border border-slate-700 rounded-xl max-w-3xl w-full mx-4 overflow-hidden transform scale-95 transition-transform duration-300 max-h-[90vh] overflow-y-auto" id="prediction-modal-content">
      <div class="bg-gradient-to-r from-purple-600 to-indigo-500 p-4 sticky top-0 z-10">
        <div class="flex justify-between items-center">
          <h3 class="text-white font-bold text-lg">AI气候预测详细报告</h3>
          <button id="close-prediction-modal" class="text-white hover:text-slate-200">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="p-5">
        <div class="flex justify-between items-center mb-5">
          <div>
            <p class="text-slate-400 text-sm">预测时间范围</p>
            <p class="text-white font-medium" id="detail-prediction-period">未来30天（2023年X月X日至X月X日）</p>
          </div>
          <div>
            <p class="text-slate-400 text-sm">预测区域</p>
            <p class="text-white font-medium" id="detail-prediction-region">全国范围</p>
          </div>
          <div>
            <p class="text-slate-400 text-sm">预测可信度</p>
            <p class="text-green-400 font-medium">92%</p>
          </div>
        </div>
        
        <div class="mb-6">
          <h4 class="text-white text-sm font-medium mb-3">全国温度趋势预测</h4>
          <div class="h-60 bg-slate-700/30 rounded-lg p-3">
            <canvas id="temperature-prediction-chart" class="w-full h-full"></canvas>
          </div>
        </div>
        
        <div class="mb-6">
          <h4 class="text-white text-sm font-medium mb-3">降水概率分布</h4>
          <div class="h-60 bg-slate-700/30 rounded-lg p-3">
            <canvas id="precipitation-prediction-chart" class="w-full h-full"></canvas>
          </div>
        </div>
        
        <div class="mb-6">
          <h4 class="text-white text-sm font-medium mb-3">极端天气事件预警</h4>
          <div class="space-y-3">
            <div class="bg-amber-900/20 border border-amber-800/30 rounded-lg p-3">
              <div class="flex justify-between">
                <span class="px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full">台风</span>
                <span class="text-slate-400 text-xs">预计15-20日</span>
              </div>
              <p class="text-white text-sm mt-2">华南地区可能受1次台风影响，带来大风和强降雨</p>
              <div class="flex justify-between items-center mt-2">
                <span class="text-amber-400 text-xs font-medium">发生概率：65%</span>
                <span class="text-slate-300 text-xs">影响程度：中等</span>
              </div>
            </div>
            
            <div class="bg-red-900/20 border border-red-800/30 rounded-lg p-3">
              <div class="flex justify-between">
                <span class="px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full">高温</span>
                <span class="text-slate-400 text-xs">预计7-14日</span>
              </div>
              <p class="text-white text-sm mt-2">江南、江淮地区可能出现持续性高温天气，部分地区超39°C</p>
              <div class="flex justify-between items-center mt-2">
                <span class="text-red-400 text-xs font-medium">发生概率：82%</span>
                <span class="text-slate-300 text-xs">影响程度：较高</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-slate-700/50 border border-slate-600 rounded-lg p-4 mb-4">
          <h4 class="text-blue-400 text-sm font-medium mb-3">AI预测总结与建议</h4>
          <p class="text-slate-300 text-sm mb-3">
            未来30天全国气候呈现"北多南少"的降水分布特征，气温整体较常年偏高。南方地区需重点防范高温干旱，北方地区需警惕强降雨可能引发的城市内涝和中小河流洪水。
          </p>
          <ul class="text-slate-300 text-sm space-y-2">
            <li class="flex items-start gap-2">
              <i class="fa fa-check-circle text-green-400 mt-0.5 text-xs"></i>
              <span>南方地区应合理调度水资源，保障农业灌溉和居民生活用水</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa fa-check-circle text-green-400 mt-0.5 text-xs"></i>
              <span>北方地区需加强防汛准备，完善城市排水系统</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa fa-check-circle text-green-400 mt-0.5 text-xs"></i>
              <span>相关部门应密切关注台风动态，及时发布预警信息</span>
            </li>
          </ul>
        </div>
        
        <button class="w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors">
          下载完整预测报告 (PDF)
        </button>
      </div>
    </div>
  </div>
</section>

<!-- 外部资源 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson@3.0.2/dist/topojson.min.js"></script>

<script>
// 全国省份数据
const provinces = [
  { name: "北京", center: [116.4074, 39.9042], risk: 65, type: "heat, drought" },
  { name: "天津", center: [117.2000, 39.1334], risk: 60, type: "heat" },
  { name: "河北", center: [114.5149, 38.0500], risk: 70, type: "heat, flood" },
  { name: "山西", center: [112.5348, 37.8651], risk: 75, type: "heat, drought" },
  { name: "内蒙古", center: [111.6708, 40.8186], risk: 55, type: "drought" },
  { name: "辽宁", center: [123.4291, 41.8056], risk: 50, type: "flood" },
  { name: "吉林", center: [125.3245, 43.8868], risk: 45, type: "flood" },
  { name: "黑龙江", center: [126.6336, 45.8038], risk: 40, type: "flood" },
  { name: "上海", center: [121.4737, 31.2304], risk: 70, type: "heat, typhoon" },
  { name: "江苏", center: [118.7969, 32.0603], risk: 80, type: "heat, flood" },
  { name: "浙江", center: [120.1551, 30.2741], risk: 75, type: "heat, typhoon" },
  { name: "安徽", center: [117.2830, 31.8611], risk: 85, type: "heat, drought" },
  { name: "福建", center: [119.2959, 26.0990], risk: 65, type: "typhoon, flood" },
  { name: "江西", center: [115.8581, 28.6822], risk: 85, type: "heat, drought" },
  { name: "山东", center: [117.0009, 36.6758], risk: 70, type: "heat, flood" },
  { name: "河南", center: [113.6654, 34.7472], risk: 80, type: "heat, flood" },
  { name: "湖北", center: [114.3055, 30.5928], risk: 85, type: "heat, flood" },
  { name: "湖南", center: [112.9822, 28.1122], risk: 80, type: "heat, flood" },
  { name: "广东", center: [113.2644, 23.1291], risk: 70, type: "typhoon, heat" },
  { name: "广西", center: [108.3200, 22.8241], risk: 60, type: "flood, typhoon" },
  { name: "海南", center: [110.3312, 20.0310], risk: 65, type: "typhoon, heat" },
  { name: "重庆", center: [106.5504, 29.5630], risk: 80, type: "heat, flood" },
  { name: "四川", center: [104.0657, 30.6570], risk: 60, type: "flood" },
  { name: "贵州", center: [106.7135, 26.5784], risk: 50, type: "flood" },
  { name: "云南", center: [102.7183, 25.0454], risk: 55, type: "drought, flood" },
  { name: "西藏", center: [91.1322, 29.6603], risk: 30, type: "" },
  { name: "陕西", center: [108.9540, 34.2658], risk: 70, type: "heat, flood" },
  { name: "甘肃", center: [103.8235, 36.0581], risk: 60, type: "drought" },
  { name: "青海", center: [101.7797, 36.6172], risk: 35, type: "" },
  { name: "宁夏", center: [106.2324, 38.4860], risk: 70, type: "heat, drought" },
  { name: "新疆", center: [87.6168, 43.8256], risk: 50, type: "drought, heat" }
];

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
  // 初始化气候趋势图表
  initClimateTrendChart();
  
  // 初始化全国风险热力图
  initChinaRiskMap();
  
  // 初始化AI预测功能
  initAIPrediction();
  
  // 初始化预警项点击事件
  initAlertItems();
  
  // 模拟一段时间后显示预警弹窗
  setTimeout(showAlertModal, 10000);
  
  // 初始化按钮切换效果
  initToggleButtons();
});

// 气候趋势图表初始化
function initClimateTrendChart() {
  const ctx = document.getElementById('climate-trend-chart').getContext('2d');
  
  // 温度数据 - 全国范围
  const years = Array.from({length: 31}, (_, i) => 1993 + i);
  const tempData = years.map((year, i) => 15.2 + (i * 0.022) + (Math.random() * 0.05 - 0.025));
  const rainfallData = years.map((year, i) => 620 + (i * 3.5) + (Math.random() * 20 - 10));
  const extremeDaysData = years.map((year, i) => 8 + (i * 0.32) + (Math.random() * 1 - 0.5));
  
  // 创建图表
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: years,
      datasets: [
        {
          label: '全国平均温度 (°C)',
          data: tempData,
          borderColor: '#ef4444',
          backgroundColor: 'rgba(239, 68, 68, 0.1)',
          tension: 0.4,
          fill: true,
          yAxisID: 'y'
        },
        {
          label: '年降水量 (mm)',
          data: rainfallData,
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.4,
          fill: true,
          yAxisID: 'y1'
        },
        {
          label: '极端天气日数',
          data: extremeDaysData,
          borderColor: '#f59e0b',
          backgroundColor: 'rgba(245, 158, 11, 0.1)',
          tension: 0.4,
          fill: true,
          yAxisID: 'y2'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        mode: 'index',
        intersect: false,
      },
      animation: {
        duration: 2000,
        easing: 'easeOutQuart'
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            maxRotation: 0,
            callback: function(value, index, values) {
              // 每5年显示一次年份
              return index % 5 === 0 ? this.getLabelForValue(value) : '';
            }
          }
        },
        y: {
          type: 'linear',
          display: true,
          position: 'left',
          title: {
            display: true,
            text: '温度 (°C)',
            color: 'rgba(255, 255, 255, 0.6)',
            font: {
              size: 10
            }
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            font: {
              size: 10
            }
          }
        },
        y1: {
          type: 'linear',
          display: true,
          position: 'right',
          title: {
            display: true,
            text: '降水量 (mm)',
            color: 'rgba(255, 255, 255, 0.6)',
            font: {
              size: 10
            }
          },
          grid: {
            drawOnChartArea: false
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            font: {
              size: 10
            }
          }
        },
        y2: {
          type: 'linear',
          display: false,
          position: 'right',
        }
      },
      plugins: {
        legend: {
          position: 'top',
          labels: {
            color: 'rgba(255, 255, 255, 0.8)',
            boxWidth: 12,
            usePointStyle: true,
            pointStyle: 'circle',
            font: {
              size: 11
            }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(15, 23, 42, 0.9)',
          borderColor: 'rgba(255, 255, 255, 0.1)',
          borderWidth: 1,
          padding: 10,
          titleColor: 'white',
          bodyColor: 'rgba(255, 255, 255, 0.8)',
          titleFont: {
            size: 13,
            weight: 'bold'
          },
          bodyFont: {
            size: 12
          },
          displayColors: true,
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) {
                label += ': ';
              }
              if (context.parsed.y !== null) {
                label += context.parsed.y.toFixed(2);
              }
              return label;
            }
          }
        }
      }
    }
  });
  
  // 周期按钮事件
  document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      // 更新按钮状态
      document.querySelectorAll('.period-btn').forEach(b => {
        b.classList.remove('active', 'bg-blue-600', 'text-white');
        b.classList.add('bg-slate-700', 'text-slate-300');
      });
      this.classList.add('active', 'bg-blue-600', 'text-white');
      this.classList.remove('bg-slate-700', 'text-slate-300');
      
      // 更新图表数据
      const period = this.textContent.trim();
      updateTrendChart(period, chart);
    });
  });
}

// 更新趋势图表数据
function updateTrendChart(period, chart) {
  let years, startYear;
  
  switch(period) {
    case '近30年':
      startYear = 1993;
      break;
    case '近10年':
      startYear = 2013;
      break;
    case '近5年':
      startYear = 2018;
      break;
  }
  
  const count = period === '近30年' ? 31 : period === '近10年' ? 11 : 6;
  years = Array.from({length: count}, (_, i) => startYear + i);
  
  // 生成对应周期的数据
  const baseTemp = 15.2 + (startYear - 1993) * 0.022;
  const tempData = years.map((year, i) => baseTemp + (i * 0.022) + (Math.random() * 0.05 - 0.025));
  
  const baseRainfall = 620 + (startYear - 1993) * 3.5;
  const rainfallData = years.map((year, i) => baseRainfall + (i * 3.5) + (Math.random() * 20 - 10));
  
  const baseExtremeDays = 8 + (startYear - 1993) * 0.32;
  const extremeDaysData = years.map((year, i) => baseExtremeDays + (i * 0.32) + (Math.random() * 1 - 0.5));
  
  // 更新图表
  chart.data.labels = years;
  chart.data.datasets[0].data = tempData;
  chart.data.datasets[1].data = rainfallData;
  chart.data.datasets[2].data = extremeDaysData;
  
  // 添加过渡动画
  chart.update('none'); // 先清除当前动画
  chart.update('animate'); // 应用新动画
}

// 初始化全国风险地图
function initChinaRiskMap() {
  const width = document.getElementById('china-map-container').clientWidth;
  const height = document.getElementById('china-map-container').clientHeight;
  
  // 创建SVG容器
  const svg = d3.select("#china-map-canvas")
    .attr("width", width)
    .attr("height", height);
  
  // 定义投影 - 适合中国地图的阿尔伯斯投影
  const projection = d3.geoAlbers()
    .center([105, 38])   // 中国中心经纬度
    .rotate([-105, -38]) // 旋转角度
    .parallels([25, 47]) // 标准纬线
    .scale(width * 1.2)  // 缩放比例
    .translate([width / 2, height / 2]); // 平移到中心
  
  const path = d3.geoPath().projection(projection);
  
  // 加载中国地图数据
  d3.json("https://cdn.jsdelivr.net/npm/china-geojson@1.0.0/dist/china.json").then(function(geojson) {
    // 绘制省份
    const provinces = svg.selectAll("path")
      .data(geojson.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr("fill", function(d) {
        // 根据省份名称匹配风险等级
        const provinceData = provinces.find(p => p.name === d.properties.name);
        const risk = provinceData ? provinceData.risk : 50;
        
        // 根据风险等级设置颜色
        if (risk < 50) return "#10b981"; // 绿色 - 低风险
        if (risk < 65) return "#eab308"; // 黄色 - 中风险
        if (risk < 80) return "#f97316"; // 橙色 - 高风险
        return "#ef4444"; // 红色 - 极高风险
      })
      .attr("stroke", "#1e293b")
      .attr("stroke-width", 1)
      .attr("opacity", 0.8)
      .attr("data-name", d => d.properties.name)
      .on("mouseover", function(event, d) {
        d3.select(this)
          .attr("opacity", 1)
          .attr("stroke", "#ffffff")
          .attr("stroke-width", 2)
          .transition()
          .duration(300);
        
        // 显示省份名称提示
        showProvinceTooltip(event, d.properties.name);
      })
      .on("mouseout", function() {
        d3.select(this)
          .attr("opacity", 0.8)
          .attr("stroke", "#1e293b")
          .attr("stroke-width", 1)
          .transition()
          .duration(300);
        
        // 隐藏提示
        hideProvinceTooltip();
      })
      .on("click", function(event, d) {
        // 点击省份显示详情
        showProvinceDetail(d.properties.name);
      })
      .transition()
      .duration(1000)
      .attrTween("d", function(d) {
        const interpolate = d3.interpolate(
          {type: "Sphere"},
          d
        );
        return function(t) {
          return path(interpolate(t));
        };
      });
    
    // 添加风险点动画
    addRiskPointsAnimation(svg, projection);
  }).catch(function(error) {
    console.error("Error loading map data:", error);
    // 加载失败时显示简化版地图
    drawFallbackMap(svg, width, height);
  });
  
  // 地图控制按钮
  let currentScale = 1;
  const scaleStep = 0.1;
  const mapContainer = document.getElementById('china-map-canvas');
  
  document.getElementById('zoom-in').addEventListener('click', () => {
    currentScale = Math.min(2, currentScale + scaleStep);
    mapContainer.style.transform = `scale(${currentScale})`;
  });
  
  document.getElementById('zoom-out').addEventListener('click', () => {
    currentScale = Math.max(0.5, currentScale - scaleStep);
    mapContainer.style.transform = `scale(${currentScale})`;
  });
  
  let isRotating = false;
  let rotationInterval;
  
  document.getElementById('rotate-map').addEventListener('click', () => {
    isRotating = !isRotating;
    
    if (isRotating) {
      let rotation = 0;
      rotationInterval = setInterval(() => {
        rotation = (rotation + 0.5) % 360;
        mapContainer.style.transform = `scale(${currentScale}) rotate(${rotation}deg)`;
      }, 50);
    } else {
      clearInterval(rotationInterval);
      mapContainer.style.transform = `scale(${currentScale})`;
    }
  });
  
  // 风险类型切换
  document.querySelectorAll('.risk-type-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.risk-type-btn').forEach(b => {
        b.classList.remove('active', 'bg-blue-600', 'text-white');
        b.classList.add('bg-slate-700', 'text-slate-300');
      });
      this.classList.add('active', 'bg-blue-600', 'text-white');
      this.classList.remove('bg-slate-700', 'text-slate-300');
      
      // 更新风险地图显示
      updateRiskMapByType(this.textContent.trim());
    });
  });
}

// 添加风险点动画
function addRiskPointsAnimation(svg, projection) {
  // 创建风险点组
  const riskPointsGroup = svg.append("g").attr("class", "risk-points");
  
  // 为每个省份添加风险点
  provinces.forEach(province => {
    if (!province.center) return;
    
    const [lon, lat] = province.center;
    const [x, y] = projection([lon, lat]);
    
    // 根据风险等级确定点的大小和颜色
    const size = 3 + (province.risk / 100) * 8;
    let color = "#10b981"; // 绿色 - 低风险
    if (province.risk >= 50) color = "#eab308"; // 黄色 - 中风险
    if (province.risk >= 65) color = "#f97316"; // 橙色 - 高风险
    if (province.risk >= 80) color = "#ef4444"; // 红色 - 极高风险
    
    // 创建风险点
    const point = riskPointsGroup.append("circle")
      .attr("cx", x)
      .attr("cy", y)
      .attr("r", size)
      .attr("fill", color)
      .attr("opacity", 0.6)
      .attr("data-name", province.name);
    
    // 添加脉动动画
    animateRiskPoint(point, size);
  });
}

// 风险点动画
function animateRiskPoint(point, baseSize) {
  function pulse() {
    point.transition()
      .duration(1500)
      .attr("r", baseSize * 1.8)
      .attr("opacity", 0)
      .on("end", function() {
        d3.select(this)
          .attr("r", baseSize)
          .attr("opacity", 0.6);
        pulse();
      });
  }
  
  pulse();
}

// 显示省份提示
function showProvinceTooltip(event, name) {
  // 检查是否已存在提示元素
  let tooltip = d3.select("#province-tooltip");
  if (tooltip.empty()) {
    tooltip = d3.select("body").append("div")
      .attr("id", "province-tooltip")
      .style("position", "absolute")
      .style("background-color", "rgba(15, 23, 42, 0.9)")
      .style("border", "1px solid rgba(255, 255, 255, 0.1)")
      .style("border-radius", "4px")
      .style("padding", "5px 10px")
      .style("color", "white")
      .style("font-size", "12px")
      .style("pointer-events", "none")
      .style("z-index", "1000")
      .style("opacity", 0);
  }
  
  // 设置提示内容和位置
  tooltip.html(name)
    .style("left", (event.pageX + 10) + "px")
    .style("top", (event.pageY - 20) + "px")
    .transition()
    .duration(200)
    .style("opacity", 1);
}

// 隐藏省份提示
function hideProvinceTooltip() {
  d3.select("#province-tooltip")
    .transition()
    .duration(200)
    .style("opacity", 0);
}

// 更新风险地图类型
function updateRiskMapByType(type) {
  // 定义风险类型对应的颜色映射函数
  function getColorByType(province, type) {
    // 找到省份数据
    const provinceData = provinces.find(p => p.name === province.getAttribute("data-name"));
    if (!provinceData) return "#64748b"; // 默认灰色
    
    // 根据风险类型和等级返回颜色
    switch(type) {
      case '综合风险':
        if (provinceData.risk < 50) return "#10b981";
        if (provinceData.risk < 65) return "#eab308";
        if (provinceData.risk < 80) return "#f97316";
        return "#ef4444";
        
      case '洪涝':
        // 洪涝风险基于综合风险和类型匹配度
        const floodRisk = provinceData.type.includes('flood') ? 
                         provinceData.risk * 1.1 : provinceData.risk * 0.6;
        if (floodRisk < 50) return "#10b981";
        if (floodRisk < 65) return "#eab308";
        if (floodRisk < 80) return "#f97316";
        return "#ef4444";
        
      case '干旱':
        const droughtRisk = provinceData.type.includes('drought') ? 
                          provinceData.risk * 1.1 : provinceData.risk * 0.6;
        if (droughtRisk < 50) return "#10b981";
        if (droughtRisk < 65) return "#eab308";
        if (droughtRisk < 80) return "#f97316";
        return "#ef4444";
        
      case '高温':
        const heatRisk = provinceData.type.includes('heat') ? 
                       provinceData.risk * 1.1 : provinceData.risk * 0.6;
        if (heatRisk < 50) return "#10b981";
        if (heatRisk < 65) return "#eab308";
        if (heatRisk < 80) return "#f97316";
        return "#ef4444";
        
      default:
        return "#64748b";
    }
  }
  
  // 更新所有省份的颜色
  d3.selectAll("#china-map-canvas path")
    .transition()
    .duration(500)
    .attr("fill", function() {
      return getColorByType(this, type);
    });
}

// 显示省份详情
function showProvinceDetail(provinceName) {
  // 找到省份数据
  const province = provinces.find(p => p.name === provinceName);
  if (!province) return;
  
  // 设置弹窗标题
  document.getElementById('province-modal-title').textContent = `${provinceName}气候风险详情`;
  
  // 确定风险等级文本
  let riskLevelText = "低风险";
  if (province.risk >= 50) riskLevelText = "中风险";
  if (province.risk >= 65) riskLevelText = "高风险";
  if (province.risk >= 80) riskLevelText = "极高风险";
  
  // 设置风险等级样式
  let riskLevelClass = "text-green-400";
  if (province.risk >= 50) riskLevelClass = "text-yellow-400";
  if (province.risk >= 65) riskLevelClass = "text-orange-400";
  if (province.risk >= 80) riskLevelClass = "text-red-400";
  
  // 更新弹窗内容
  document.getElementById('province-risk-level').textContent = riskLevelText;
  document.getElementById('province-risk-level').className = `text-white font-medium mt-1 text-xl ${riskLevelClass}`;
  
  // 转换风险类型为中文
  const typeMap = {
    'heat': '高温',
    'drought': '干旱',
    'flood': '洪涝',
    'typhoon': '台风'
  };
  
  const riskTypes = province.type.split(',').map(t => typeMap[t.trim()]).join('、');
  document.getElementById('province-risk-type').textContent = riskTypes || "无显著风险";
  
  // 生成未来预警信息
  const futureAlerts = [
    "无显著预警",
    "1次高温预警",
    "1次降水预警",
    "1次高温和1次降水预警",
    "2次高温预警"
  ];
  const alertIndex = Math.min(Math.floor(province.risk / 20), futureAlerts.length - 1);
  document.getElementById('province-future-alert').textContent = futureAlerts[alertIndex];
  
  // 生成AI分析内容
  const aiAnalysis = [
    `${provinceName}未来30天气候状况总体平稳，无显著极端天气事件发生。`,
    `${provinceName}未来30天可能出现阶段性高温天气，但持续时间较短，影响有限。`,
    `根据AI模型预测，${provinceName}未来30天发生${riskTypes}的概率较高，建议相关部门提前做好准备。`,
    `AI分析显示，${provinceName}未来30天气候风险较高，${riskTypes}发生概率达70%以上，需加强防范。`,
    `紧急提示：${provinceName}未来30天面临极高气候风险，可能出现持续性${riskTypes}，建议启动应急响应机制。`
  ];
  document.getElementById('province-ai-analysis').textContent = aiAnalysis[alertIndex];
  
  // 初始化省份图表
  initProvinceChart(provinceName);
  
  // 显示弹窗
  const modal = document.getElementById('province-detail-modal');
  const modalContent = document.getElementById('province-modal-content');
  
  modal.classList.remove('opacity-0', 'pointer-events-none');
  setTimeout(() => {
    modalContent.classList.remove('scale-95');
    modalContent.classList.add('scale-100');
  }, 50);
  
  // 关闭按钮事件
  document.getElementById('close-province-modal').addEventListener('click', hideProvinceDetail);
  document.getElementById('close-province-btn').addEventListener('click', hideProvinceDetail);
}

// 隐藏省份详情
function hideProvinceDetail() {
  const modal = document.getElementById('province-detail-modal');
  const modalContent = document.getElementById('province-modal-content');
  
  modalContent.classList.remove('scale-100');
  modalContent.classList.add('scale-95');
  
  setTimeout(() => {
    modal.classList.add('opacity-0', 'pointer-events-none');
  }, 300);
}

// 初始化省份图表
function initProvinceChart(provinceName) {
  const ctx = document.getElementById('province-chart').getContext('2d');
  
  // 生成过去12个月的模拟数据
  const months = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
  const tempData = months.map(() => 5 + Math.random() * 25);
  const rainfallData = months.map(() => 10 + Math.random() * 200);
  
  // 创建或更新图表
  if (window.provinceChart) {
    window.provinceChart.data.labels = months;
    window.provinceChart.data.datasets[0].data = tempData;
    window.provinceChart.data.datasets[1].data = rainfallData;
    window.provinceChart.update();
  } else {
    window.provinceChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: months,
        datasets: [
          {
            label: '月平均温度 (°C)',
            data: tempData,
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y'
          },
          {
            label: '月降水量 (mm)',
            data: rainfallData,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        scales: {
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.05)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              font: { size: 10 }
            }
          },
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: {
              display: true,
              text: '温度 (°C)',
              color: 'rgba(255, 255, 255, 0.6)',
              font: { size: 10 }
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.05)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              font: { size: 10 }
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            title: {
              display: true,
              text: '降水量 (mm)',
              color: 'rgba(255, 255, 255, 0.6)',
              font: { size: 10 }
            },
            grid: {
              drawOnChartArea: false
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              font: { size: 10 }
            }
          }
        },
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: 'rgba(255, 255, 255, 0.8)',
              boxWidth: 10,
              font: { size: 10 }
            }
          }
        }
      }
    });
  }
}

// 加载地图失败时绘制简化版地图
function drawFallbackMap(svg, width, height) {
  // 创建简化的中国地图轮廓
  const chinaOutline = svg.append("path")
    .attr("d", `M${width*0.3},${height*0.2} Q${width*0.5},${height*0.1} ${width*0.7},${height*0.2} T${width*0.8},${height*0.5} T${width*0.7},${height*0.8} T${width*0.5},${height*0.9} T${width*0.3},${height*0.8} T${width*0.2},${height*0.5} T${width*0.3},${height*0.2} Z`)
    .attr("fill", "#334155")
    .attr("stroke", "#1e293b")
    .attr("stroke-width", 2)
    .attr("opacity", 0.8);
  
  // 添加提示文本
  svg.append("text")
    .attr("x", width / 2)
    .attr("y", height / 2)
    .attr("text-anchor", "middle")
    .attr("dominant-baseline", "middle")
    .attr("fill", "rgba(255, 255, 255, 0.6)")
    .attr("font-size", "14px")
    .text("全国地图加载中...");
  
  // 添加省份标记点
  provinces.forEach(province => {
    if (!province.center) return;
    
    // 简单映射经纬度到简化地图上的位置
    const x = width * (0.3 + (province.center[0] - 73) / (135 - 73) * 0.5);
    const y = height * (0.2 + (53 - province.center[1]) / (53 - 18) * 0.7);
    
    // 根据风险等级确定点的大小和颜色
    const size = 3 + (province.risk / 100) * 6;
    let color = "#10b981"; // 绿色 - 低风险
    if (province.risk >= 50) color = "#eab308"; // 黄色 - 中风险
    if (province.risk >= 65) color = "#f97316"; // 橙色 - 高风险
    if (province.risk >= 80) color = "#ef4444"; // 红色 - 极高风险
    
    // 创建风险点
    const point = svg.append("circle")
      .attr("cx", x)
      .attr("cy", y)
      .attr("r", size)
      .attr("fill", color)
      .attr("opacity", 0.6)
      .attr("data-name", province.name)
      .on("click", function() {
        showProvinceDetail(province.name);
      });
    
    // 添加脉动动画
    animateRiskPoint(point, size);
  });
}

// 初始化AI预测功能
function initAIPrediction() {
  // 预测按钮点击事件
  document.getElementById('run-prediction').addEventListener('click', function() {
    // 显示加载状态
    this.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 分析中...';
    this.disabled = true;
    
    // 获取选中的参数
    const period = document.getElementById('prediction-period').value;
    const region = document.getElementById('focus-region').value;
    
    
    // 模拟AI分析延迟
    setTimeout(() => {
      // 更新结果显示
      document.getElementById('prediction-results').classList.remove('hidden');
      
      // 恢复按钮状态
      this.innerHTML = '<i class="fa fa-bolt"></i> AI智能预测分析';
      this.disabled = false;
      
      // 添加显示动画
      const resultElement = document.getElementById('prediction-results');
      resultElement.style.opacity = '0';
      resultElement.style.transform = 'translateY(10px)';
      resultElement.style.transition = 'opacity 0.5s, transform 0.5s';
      
      setTimeout(() => {
        resultElement.style.opacity = '1';
        resultElement.style.transform = 'translateY(0)';
      }, 50);
    }, 2000);
  });
  
  // 查看详细预测报告
  document.getElementById('show-detail-prediction').addEventListener('click', function() {
    // 更新详细报告的时间和区域
    const periodMap = {
      '15': '未来15天',
      '30': '未来30天',
      '90': '未来3个月',
      '180': '未来6个月'
    };
    
    const regionMap = {
      'national': '全国范围',
      'north': '华北地区',
      'northeast': '东北地区',
      'east': '华东地区',
      'south': '华南地区',
      'central': '华中地区',
      'west': '西部地区',
      'northwest': '西北地区',
      'southwest': '西南地区'
    };
    
    const period = document.getElementById('prediction-period').value;
    const region = document.getElementById('focus-region').value;
    
    // 获取当前日期并格式化
    const today = new Date();
    const endDate = new Date();
    endDate.setDate(today.getDate() + parseInt(period));
    
    const formatDate = (date) => {
      return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
    };
    
    document.getElementById('detail-prediction-period').textContent = 
      `${periodMap[period]}（${formatDate(today)}至${formatDate(endDate)}）`;
    document.getElementById('detail-prediction-region').textContent = regionMap[region];
    
    // 初始化预测图表
    initPredictionCharts();
    
    // 显示详细预测弹窗
    const modal = document.getElementById('prediction-detail-modal');
    const modalContent = document.getElementById('prediction-modal-content');
    
    modal.classList.remove('opacity-0', 'pointer-events-none');
    setTimeout(() => {
      modalContent.classList.remove('scale-95');
      modalContent.classList.add('scale-100');
    }, 50);
    
    // 关闭按钮事件
    document.getElementById('close-prediction-modal').addEventListener('click', hidePredictionDetail);
  });
}

// 初始化预测图表
function initPredictionCharts() {
  // 温度预测图表
  const tempCtx = document.getElementById('temperature-prediction-chart').getContext('2d');
  const days = Array.from({length: 30}, (_, i) => `第${i+1}天`);
  
  // 生成温度预测数据
  const baseTemp = 26;
  const tempData = days.map((_, i) => {
    // 创建有波动的趋势
    const trend = i * 0.1; // 整体上升趋势
    const波动 = (Math.sin(i * 0.5) * 2) + (Math.random() * 1.5 - 0.75);
    return baseTemp + trend + 波动;
  });
  
  // 历史同期数据
  const historicalData = days.map(() => baseTemp + (Math.random() * 3 - 1.5));
  
  if (window.tempPredictionChart) {
    window.tempPredictionChart.data.datasets[0].data = tempData;
    window.tempPredictionChart.data.datasets[1].data = historicalData;
    window.tempPredictionChart.update();
  } else {
    window.tempPredictionChart = new Chart(tempCtx, {
      type: 'line',
      data: {
        labels: days,
        datasets: [
          {
            label: '预测温度 (°C)',
            data: tempData,
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            fill: true
          },
          {
            label: '历史同期平均 (°C)',
            data: historicalData,
            borderColor: '#94a3b8',
            borderDash: [5, 5],
            tension: 0.4,
            fill: false,
            pointRadius: 0
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.05)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              maxRotation: 0,
              autoSkip: true,
              maxTicksLimit: 10,
              font: { size: 10 }
            }
          },
          y: {
            grid: {
              color: 'rgba(255, 255, 255, 0.05)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              font: { size: 10 }
            }
          }
        },
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: 'rgba(255, 255, 255, 0.8)',
              boxWidth: 10,
              font: { size: 10 }
            }
          }
        }
      }
    });
  }
  
  // 降水概率图表
  const rainCtx = document.getElementById('precipitation-prediction-chart').getContext('2d');
  
  // 生成降水概率数据
  const rainData = days.map((_, i) => {
    // 创建周期性降水概率
    return 20 + Math.sin(i * 0.4) * 30 + (Math.random() * 20 - 10);
  });
  
  if (window.rainPredictionChart) {
    window.rainPredictionChart.data.datasets[0].data = rainData;
    window.rainPredictionChart.update();
  } else {
    window.rainPredictionChart = new Chart(rainCtx, {
      type: 'bar',
      data: {
        labels: days,
        datasets: [
          {
            label: '降水概率 (%)',
            data: rainData,
            backgroundColor: function(context) {
              const value = context.dataset.data[context.dataIndex];
              return value > 70 ? 'rgba(239, 68, 68, 0.7)' :
                     value > 50 ? 'rgba(249, 115, 22, 0.7)' :
                     value > 30 ? 'rgba(234, 179, 8, 0.7)' :
                     'rgba(59, 130, 246, 0.7)';
            },
            borderWidth: 0,
            borderRadius: 2
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.05)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              maxRotation: 0,
              autoSkip: true,
              maxTicksLimit: 10,
              font: { size: 10 }
            }
          },
          y: {
            min: 0,
            max: 100,
            grid: {
              color: 'rgba(255, 255, 255, 0.05)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.6)',
              callback: function(value) {
                return value + '%';
              },
              font: { size: 10 }
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
  }
}

// 隐藏预测详情
function hidePredictionDetail() {
  const modal = document.getElementById('prediction-detail-modal');
  const modalContent = document.getElementById('prediction-modal-content');
  
  modalContent.classList.remove('scale-100');
  modalContent.classList.add('scale-95');
  
  setTimeout(() => {
    modal.classList.add('opacity-0', 'pointer-events-none');
  }, 300);
}

// 初始化预警项点击事件
function initAlertItems() {
  document.querySelectorAll('.alert-item').forEach(item => {
    item.addEventListener('click', function() {
      const alertId = this.getAttribute('data-alert-id');
      showAlertDetail(alertId);
    });
  });
}

// 显示预警详情
function showAlertDetail(alertId) {
  // 根据预警ID设置不同的弹窗内容
  const alerts = {
    '1': {
      title: '江南地区持续高温预警',
      content: '监测显示，江南地区将出现持续性极端高温天气，未来5天最高气温可达38-40°C，部分地区可能突破历史同期纪录。高温天气可能导致中暑事件增加，电力负荷攀升。',
      area: '江苏南部、安徽南部、浙江大部、江西东北部、上海',
      duration: '未来5-7天',
      measures: [
        '做好防暑降温工作，高温时段尽量减少户外活动',
        '有关部门应保障电力供应，做好应对用电高峰准备',
        '加强水资源管理，保障农业灌溉用水',
        '注意防范城市和森林火灾风险'
      ]
    },
    '2': {
      title: '华北地区强降雨预警',
      content: '受冷暖空气共同影响，未来24小时华北地区将出现大到暴雨，局部地区有大暴雨，小时雨强可达30-50毫米。强降雨可能引发城市内涝和中小河流洪水。',
      area: '北京、天津、河北中南部、山西东部、河南北部',
      duration: '未来24-36小时',
      measures: [
        '相关地区应做好防汛准备，及时排除城市低洼地区积水',
        '山区需防范山洪和地质灾害，必要时组织危险区群众转移',
        '公众应减少前往低洼地带和山区，注意安全',
        '关注水文和气象部门发布的最新预警信息'
      ]
    },
    '3': {
      title: '东南沿海台风影响预警',
      content: '今年第X号台风"木兰"目前位于南海东北部海面，强度逐渐加强，预计将在未来48小时内登陆我国东南沿海地区，带来大风和强降雨天气。',
      area: '广东东部、福建南部、台湾岛南部',
      duration: '未来3-5天',
      measures: [
        '沿海地区应加固港口设施，船舶及时回港避风',
        '相关部门应做好防风防汛准备，防范城市内涝',
        '公众应减少外出，远离广告牌等易被风吹落的物体',
        '渔民应及时回港，确保人身安全'
      ]
    }
  };
  
  const alert = alerts[alertId];
  if (!alert) return;
  
  // 更新弹窗内容
  document.querySelector('#alert-modal h4').textContent = alert.title;
  document.querySelector('#alert-modal p').innerHTML = alert.content;
  
  // 更新信息卡片
  const infoCards = document.querySelectorAll('#alert-modal .grid-cols-2 .bg-slate-700/50');
  infoCards[0].innerHTML = `
    <p class="text-slate-400 text-xs">预计持续时间</p>
    <p class="text-white font-medium mt-1">${alert.duration}</p>
  `;
  infoCards[1].innerHTML = `
    <p class="text-slate-400 text-xs">影响区域</p>
    <p class="text-white font-medium mt-1">${alert.area}</p>
  `;
  
  // 更新建议措施
  const measuresList = document.querySelector('#alert-modal .bg-amber-900/20 ul');
  measuresList.innerHTML = '';
  
  alert.measures.forEach(measure => {
    const li = document.createElement('li');
    li.className = 'flex items-start gap-2';
    li.innerHTML = `
      <i class="fa fa-check-circle text-amber-400 mt-0.5 text-xs"></i>
      <span>${measure}</span>
    `;
    measuresList.appendChild(li);
  });
  
  // 显示弹窗
  showAlertModal();
}

// 显示预警弹窗
function showAlertModal() {
  const modal = document.getElementById('alert-modal');
  const modalContent = document.getElementById('modal-content');
  
  modal.classList.remove('opacity-0', 'pointer-events-none');
  setTimeout(() => {
    modalContent.classList.remove('scale-95');
    modalContent.classList.add('scale-100');
  }, 50);
  
  // 弹窗关闭按钮
  document.getElementById('close-alert-modal').addEventListener('click', hideAlertModal);
}

// 隐藏预警弹窗
function hideAlertModal() {
  const modal = document.getElementById('alert-modal');
  const modalContent = document.getElementById('modal-content');
  
  modalContent.classList.remove('scale-100');
  modalContent.classList.add('scale-95');
  
  setTimeout(() => {
    modal.classList.add('opacity-0', 'pointer-events-none');
  }, 300);
}

// 初始化按钮切换效果
function initToggleButtons() {
  // 为所有按钮添加悬停效果
  document.querySelectorAll('button').forEach(button => {
    if (!button.classList.contains('no-hover-effect')) {
      button.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
        this.style.transition = 'transform 0.2s, box-shadow 0.2s';
      });
      
      button.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = 'none';
      });
    }
  });
}

// 窗口大小调整事件
window.addEventListener('resize', function() {
  // 调整地图大小
  const mapContainer = document.getElementById('china-map-container');
  const width = mapContainer.clientWidth;
  const height = mapContainer.clientHeight;
  
  d3.select("#china-map-canvas")
    .attr("width", width)
    .attr("height", height);
});
</script>

<style>
/* 基础样式 */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', system-ui, sans-serif;
}

/* 自定义滚动条 */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: rgba(15, 23, 42, 0.5);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb {
  background: rgba(148, 163, 184, 0.5);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(148, 163, 184, 0.8);
}

/* 颜色系统 */
.bg-slate-900 { background-color: #0f172a; }
.bg-slate-800 { background-color: #1e293b; }
.bg-slate-700 { background-color: #334155; }
.bg-slate-600 { background-color: #475569; }

.text-white { color: #ffffff; }
.text-slate-300 { color: #cbd5e1; }
.text-slate-400 { color: #94a3b8; }

.text-red-400 { color: #f87171; }
.text-blue-400 { color: #60a5fa; }
.text-green-400 { color: #6ee7b7; }
.text-amber-400 { color: #fbbf24; }
.text-orange-400 { color: #f97316; }
.text-yellow-400 { color: #eab308; }
.text-purple-400 { color: #c084fc; }

.bg-red-500 { background-color: #ef4444; }
.bg-blue-500 { background-color: #3b82f6; }
.bg-green-500 { background-color: #10b981; }
.bg-amber-500 { background-color: #f59e0b; }
.bg-orange-500 { background-color: #f97316; }
.bg-yellow-500 { background-color: #eab308; }
.bg-purple-500 { background-color: #8b5cf6; }

/* 动画效果 */
.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.pulse {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* 地图容器样式 */
#china-map-canvas {
  transition: transform 0.3s ease;
  transform-origin: center;
}

/* 响应式调整 */
@media (max-width: 1024px) {
  .grid-cols-3 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  
  .lg:col-span-2 {
    grid-column: span 1 / span 1;
  }
  
  .lg:col-span-1 {
    grid-column: span 1 / span 1;
  }
}

@media (max-width: 640px) {
  .grid-cols-3, .grid-cols-2 {
    grid-template-columns: repeat(1, minmax(0, 1fr));
  }
  
  #climate-risk-map {
    height: 300px;
  }
}
</style>

        <!-- 5. 全国气候事件时间线页面 -->
        <div id="timeline-page" class="page-content hidden">
          <div class="mb-6">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">全国气候事件时间线</h2>
            <p class="text-dark-100 mt-1">展示全国重大气候事件的时间发展脉络</p>
          </div>
          
          <!-- 嵌入事件时间线可视化 -->
            <div class="fixed top-40 left-40 right-0 bottom-0 z-0">
              <iframe src="事件时间线.html" class="w-full h-full border-0" title="气候事件时间线"></iframe>
            </div>
        </div>

        <!-- 6. 全国气候新闻与政策聚合页面 -->
        <div id="news-policy-page" class="page-content hidden">
          <div class="mb-6">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">新闻政策聚合</h2>
            <p class="text-dark-100 mt-1">聚合全国最新气候新闻和政策动态</p>
          </div>


  <!-- 主要内容区：新闻列表与详情 -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- 新闻列表区域 -->
    <div id="news-list-container" class="lg:col-span-1">
      <div class="bg-gray-900/50 backdrop-blur-sm rounded-xl shadow-[0_0_15px_rgba(0,255,255,0.1)] border border-cyan-500/20 overflow-hidden h-[calc(100vh-220px)] flex flex-col">
        <div class="p-4 border-b border-cyan-500/20 flex justify-between items-center">
          <h3 class="font-semibold text-white">新闻政策列表</h3>
          <span id="news-count" class="text-sm text-gray-400">共 12 条内容</span>
        </div>
        
        <!-- 新闻列表 -->
        <div id="news-list" class="overflow-y-auto scrollbar-hide flex-grow p-2">
          <!-- 新闻项 1 -->
          <div class="news-item bg-gray-900/60 rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-800/60 border border-cyan-500/10 hover:border-cyan-400/30 transition-all" data-id="news-1" data-type="policy">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-emerald-400"></div>
              <div class="flex-grow min-w-0">
                <div class="flex items items-center gap-2 mb-1">
                  <span class="px-2 py-0.5 bg-emerald-400/10 text-emerald-400 text-xs rounded-full">政策文件</span>
                  <span class="text-xs text-gray-400">2023-08-15</span>
                </div>
                <h4 class="font-medium text-white truncate">《国家适应气候变化战略2023-2035年》正式发布</h4>
                <p class="text-gray-300 text-sm mt-1 line-clamp-2">国家发改委发布最新适应气候变化战略，明确未来12年适应气候变化工作的指导思想、主要目标和重点任务。</p>
              </div>
            </div>
          </div>
          
          <!-- 新闻项 2 -->
          <div class="news-item bg-gray-900/60 rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-800/60 border border-cyan-500/10 hover:border-cyan-400/30 transition-all" data-id="news-2" data-type="news">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-cyan-400"></div>
              <div class="flex-grow min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <span class="px-2 py-0.5 bg-cyan-400/10 text-cyan-400 text-xs rounded-full">最新新闻</span>
                  <span class="text-xs text-gray-400">2023-08-14</span>
                </div>
                <h4 class="font-medium text-white truncate">全国碳市场第二个履约周期顺利收官</h4>
                <p class="text-gray-300 text-sm mt-1 line-clamp-2">生态环境部表示，全国碳市场第二个履约周期顺利收官，覆盖年排放量约45亿吨二氧化碳，市场运行总体平稳。</p>
              </div>
            </div>
          </div>
          
          <!-- 新闻项 3 -->
          <div class="news-item bg-gray-900/60 rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-800/60 border border-cyan-500/10 hover:border-cyan-400/30 transition-all" data-id="news-3" data-type="news">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-cyan-400"></div>
              <div class="flex-grow min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <span class="px-2 py-0.5 bg-cyan-400/10 text-cyan-400 text-xs rounded-full">最新新闻</span>
                  <span class="text-xs text-gray-400">2023-08-12</span>
                </div>
                <h4 class="font-medium text-white truncate">我国将建立气候适应型城市评价标准体系</h4>
                <p class="text-gray-300 text-sm mt-1 line-clamp-2">住房和城乡建设部计划在全国范围内建立气候适应型城市评价标准体系，提升城市应对气候变化能力。</p>
              </div>
            </div>
          </div>
          
          <!-- 新闻项 4 -->
          <div class="news-item bg-gray-900/60 rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-800/60 border border-cyan-500/10 hover:border-cyan-400/30 transition-all" data-id="news-4" data-type="policy">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-emerald-400"></div>
              <div class="flex-grow min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <span class="px-2 py-0.5 bg-emerald-400/10 text-emerald-400 text-xs rounded-full">政策文件</span>
                  <span class="text-xs text-gray-400">2023-08-10</span>
                </div>
                <h4 class="font-medium text-white truncate">《关于推动新时代气候投融资工作的指导意见》出台</h4>
                <p class="text-gray-300 text-sm mt-1 line-clamp-2">国家发改委等多部门联合印发指导意见，旨在引导和促进更多资金投向气候适应和减缓领域。</p>
              </div>
            </div>
          </div>
          
          <!-- 新闻项 5 -->
          <div class="news-item bg-gray-900/60 rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-800/60 border border-cyan-500/10 hover:border-cyan-400/30 transition-all" data-id="news-5" data-type="news">
            <div class="flex items-start gap-3">
              <div class="flex-shrink-0 w-2 h-2 mt-2 rounded-full bg-cyan-400"></div>
              <div class="flex-grow min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <span class="px-2 py-0.5 bg-cyan-400/10 text-cyan-400 text-xs rounded-full">最新新闻</span>
                  <span class="text-xs text-gray-400">2023-08-08</span>
                </div>
                <h4 class="font-medium text-white truncate">我国首次实现省级行政区气候风险普查全覆盖</h4>
                <p class="text-gray-300 text-sm mt-1 line-clamp-2">应急管理部宣布，我国已完成31个省(自治区、直辖市)气候风险普查工作，为防灾减灾提供科学依据。</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 加载更多 -->
        <div class="p-3 border-t border-cyan-500/20 text-center">
          <button id="load-more-news" class="px-4 py-2 border border-cyan-500/30 hover:border-cyan-400 text-gray-300 hover:text-white rounded-lg transition transition-colors text-sm">
            加载更多 <i class="fa fa-angle-down ml-1"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- 新闻详情与AI分析区域 -->
    <div id="news-detail-container" class="lg:col-span-2 bg-gray-900/50 backdrop-blur-sm rounded-xl shadow-[0_0_15px_rgba(0,255,255,0.1)] border border-cyan-500/20 overflow-hidden h-[calc(100vh-220px)] flex flex-col">
      <!-- 初始提示 -->
      <div id="news-detail-placeholder" class="flex-grow flex flex-col items-center justify-center p-8 text-center">
        <div class="w-20 h-20 rounded-full bg-gray-900/80 flex items-center justify-center mb-4 border border-cyan-500/20">
          <i class="fa fa-newspaper-o text-3xl text-cyan-400"></i>
        </div>
        <h3 class="text-xl font-medium text-white mb-2">选择新闻查看详情</h3>
        <p class="text-gray-400 max-w-md">从左侧列表中选择一条新闻或政策文件，查看详细内容及AI分析解读</p>
      </div>
      
      <!-- 新闻详情内容 (默认隐藏) -->
      <div id="news-detail-content" class="hidden flex flex flex-col h-full">
        <!-- 详情头部 -->
        <div class="p-4 border-b border-cyan-500/20 flex justify-between items-center">
          <div class="flex items-center gap-3">
            <button id="back-to-list" class="p-2 rounded-lg hover:bg-cyan-500/10 text-cyan-400/60 hover:text-white transition-colors" title="返回列表">
              <i class="fa fa-arrow-left"></i>
            </button>
            <span id="detail-current-type" class="px-2 py-0.5 bg-emerald-400/10 text-emerald-400 text-xs rounded-full">政策文件</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="share-news" class="p-2 rounded-lg hover:bg-cyan-500/10 text-cyan-400/60 hover:text-white transition-colors" title="分享">
              <i class="fa fa-share-alt"></i>
            </button>
            <button id="save-news" class="p-2 rounded-lg hover:bg-cyan-500/10 text-cyan-400/60 hover:text-white transition-colors" title="收藏">
              <i class="fa fa-star-o"></i>
            </button>
          </div>
        </div>
        
        <!-- 详情内容区域 -->
        <div class="flex-grow overflow-y-auto scrollbar-hide p-6">
          <!-- 新闻标题与信息 -->
          <div class="mb-6">
            <h3 id="detail-title" class="text-2xl font-bold text-white mb-4">《国家适应气候变化战略2023-2035年》正式发布</h3>
            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-400 mb-4">
              <div class="flex items-center">
                <i class="fa fa-calendar-o mr-2"></i>
                <span id="detail-date">2023-08-15</span>
              </div>
              <div class="flex items-center">
                <i class="fa fa-building-o mr-2"></i>
                <span id="detail-source">国家发展和改革委员会</span>
              </div>
              <div class="flex items-center">
                <i class="fa fa-map-marker mr-2"></i>
                <span id="detail-region">全国</span>
              </div>
              <div class="flex items-center">
                <i class="fa fa-eye mr-2"></i>
                <span id="detail-views">2,354 次浏览</span>
              </div>
            </div>
          </div>
          
          <!-- 新闻内容 -->
          <div id="detail-content" class="prose prose-invert max-w-none text-white mb-8">
            <p>国家发展和改革委员会于2023年8月15日正式发布《国家适应气候变化战略2023-2035年》（以下简称《战略》），这是我国应对气候变化的重要指导性文件，明确了未来12年适应气候变化工作的指导思想、主要目标、重点任务和保障措施。</p>
            
            <p>《战略》指出，当前全球气候变暖趋势加剧，极端天气气候事件频发，我国面临的气候风险日益严峻。适应气候变化是国家可持续发展的内在要求，是主动应对气候变化的重要内容，对于保障经济社会发展、维护人民生命财产安全具有重要意义。</p>
            
            <h4 class="text-white">主要目标</h4>
            <p>到2025年，我国适应气候变化的政策体系和体制机制基本形成，重点领域适应能力显著增强，气候风险管理水平明显提升。到2035年，适应气候变化能力达到世界先进水平，气候风险得到有效控制，形成适应气候变化的良性循环。</p>
            
            <h4 class="text-white">重点任务</h4>
            <p>《战略》明确了八大重点任务：</p>
            <ol class="list-decimal pl-5 space-y-1 text-gray-300">
              <li>加强气候风险评估与管理</li>
              <li>提升农业适应气候变化能力</li>
              <li>增强水资源适应气候变化能力</li>
              <li>提高生态系统适应气候变化能力</li>
              <li>强化城乡建设适应气候变化能力</li>
              <li>加强基础设施适应气候变化能力</li>
              <li>提升健康与公共卫生领域适应能力</li>
              <li>加强气候适应型社会建设</li>
            </ol>
            
            <p>国家发展和改革委员会有关负责人表示，将通过加强组织领导、完善法律法规、加大资金投入、强化科技支撑、健全标准体系、加强国际合作等措施，确保《战略》各项任务落到实处。</p>
          </div>
          
          <!-- 原文链接 -->
          <div class="mb-8 p-4 bg-gray-900/80 rounded-lg border border-cyan-500/20">
            <a href="#" target="_blank" class="flex items-center text-cyan-400 hover:text-white transition-colors">
              <i class="fa fa-external-link mr-2"></i>
              <span>查看官方原文</span>
            </a>
          </div>
          
          <!-- AI分析区域 -->
          <div class="bg-cyan-500/5 rounded-xl border border-cyan-500/20 p-5">
            <div class="flex items-center mb-4">
              <div class="w-10 h-10 rounded-full bg-cyan-500/10 flex items-center justify-center mr-3">
                <i class="fa fa-robot text-cyan-400"></i>
              </div>
              <h4 class="text-lg font-medium text-white">AI政策分析</h4>
            </div>
            
            <div class="text-gray-300 space-y-3">
              <p>本次《国家适应气候变化战略2023-2035年》的发布，反映出我国在应对气候变化方面的战略思路已从单纯的减排转向"减缓与适应并重"的新阶段。这一转变背后反映了几个关键问题：</p>
              
              <div class="pl-4 border-l-2 border-cyan-400/50">
                <p><strong class="text-white">1. 气候风险已成为现实威胁</strong> - 战略的出台表明极端天气事件频发已对我国经济社会发展构成实质性威胁，需要系统性应对。</p>
              </div>
              
              <div class="pl-4 border-l-2 border-cyan-400/50">
                <p><strong class="text-white">2. 适应能力建设的迫切性</strong> - 与发达国家相比，我国在气候适应方面的基础仍然薄弱，特别是在农业、水资源等关键领域，亟需加强能力建设。</p>
              </div>
              
              <div class="pl-4 border-l-2 border-cyan-400/50">
                <p><strong class="text-white">3. 多部门协同治理的必要性</strong> - 战略涉及多个领域和部门，反映出气候变化应对需要打破条块分割，建立跨部门协同机制。</p>
              </div>
              
              <div class="pl-4 border-l-2 border-cyan-400/50">
                <p><strong class="text-white">4. 长期规划与短期行动的结合</strong> - 12年的时间跨度表明气候变化适应是一项长期任务，需要将长期规划与短期行动有机结合。</p>
              </div>
              
              <p>总体而言，该战略的发布标志着我国应对气候变化工作进入了更加系统、全面和务实的新阶段，将为我国经济社会高质量发展提供重要保障。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 新闻政策页面相关脚本 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // 获取DOM元素
  const newsItems = document.querySelectorAll('.news-item');
  const newsDetailPlaceholder = document.getElementById('news-detail-placeholder');
  const newsDetailContent = document.getElementById('news-detail-content');
  const backToListBtn = document.getElementById('back-to-list');
  const refreshNewsBtn = document.getElementById('refresh-news');
  const autoRefreshSelect = document.getElementById('auto-refresh-interval');
  const loadMoreNewsBtn = document.getElementById('load-more-news');
  const newsTypeFilter = document.getElementById('news-type-filter');
  const newsTimeFilter = document.getElementById('news-time-filter');
  const newsRegionFilter = document.getElementById('news-region-filter');
  const newsSearchInput = document.getElementById('news-search');
  
  // 新闻数据（实际应用中可从API获取）
  const newsData = {
    'news-1': {
      title: '《国家适应气候变化战略2023-2035年》正式发布',
      type: 'policy',
      date: '2023-08-15',
      source: '国家发展和改革委员会',
      region: '全国',
      views: '2,354',
      content: `<p>国家发展和改革委员会于2023年8月15日正式发布《国家适应气候变化战略2023-2035年》（以下简称《战略》），这是我国应对气候变化的重要指导性文件，明确了未来12年适应气候变化工作的指导思想、主要目标、重点任务和保障措施。</p>
      
      <p>《战略》指出，当前全球气候变暖趋势加剧，极端天气气候事件频发，我国面临的气候风险日益严峻。适应气候变化是国家可持续发展的内在要求，是主动应对气候变化的重要内容，对于保障经济社会发展、维护人民生命财产安全具有重要意义。</p>
      
      <h4 class="text-white">主要目标</h4>
      <p>到2025年，我国适应气候变化的政策体系和体制机制基本形成，重点领域适应能力显著增强，气候风险管理水平明显提升。到2035年，适应气候变化能力达到世界先进水平，气候风险得到有效控制，形成适应气候变化的良性循环。</p>
      
      <h4 class="text-white">重点任务</h4>
      <p>《战略》明确了八大重点任务：</p>
      <ol class="list-decimal pl-5 space-y-1 text-gray-300">
        <li>加强气候风险评估与管理</li>
        <li>提升农业适应气候变化能力</li>
        <li>增强水资源适应气候变化能力</li>
        <li>提高生态系统适应气候变化能力</li>
        <li>强化城乡建设适应气候变化能力</li>
        <li>加强基础设施适应气候变化能力</li>
        <li>提升健康与公共卫生领域适应能力</li>
        <li>加强气候适应型社会建设</li>
      </ol>
      
      <p>国家发展和改革委员会有关负责人表示，将通过加强组织领导、完善法律法规、加大资金投入、强化科技支撑、健全标准体系、加强国际合作等措施，确保《战略》各项任务落到实处。</p>`,
      aiAnalysis: `本次《国家适应气候变化战略2023-2035年》的发布，反映出我国在应对气候变化方面的战略思路已从单纯的减排转向"减缓与适应并重"的新阶段。这一转变背后反映了几个关键问题：
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">1. 气候风险已成为现实威胁</strong> - 战略的出台表明极端天气事件频发已对我国经济社会发展构成实质性威胁，需要系统性应对。</p>
      </div>
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">2. 适应能力建设的迫切性</strong> - 与发达国家相比，我国在气候适应方面的基础仍然薄弱，特别是在农业、水资源等关键领域，亟需加强能力建设。</p>
      </div>
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">3. 多部门协同治理的必要性</strong> - 战略涉及多个领域和部门，反映出气候变化应对需要打破条块分割，建立跨部门协同机制。</p>
      </div>
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">4. 长期规划与短期行动的结合</strong> - 12年的时间跨度表明气候变化适应是一项长期任务，需要将长期规划与短期行动有机结合。</p>
      </div>
      
      <p>总体而言，该战略的发布标志着我国应对气候变化工作进入了更加系统、全面和务实的新阶段，将为我国经济社会高质量发展提供重要保障。`
    },
    'news-2': {
      title: '全国碳市场第二个履约周期顺利收官',
      type: 'news',
      date: '2023-08-14',
      source: '生态环境部',
      region: '全国',
      views: '1,892',
      content: `<p>生态环境部今日宣布，全国碳市场第二个履约周期顺利收官。数据显示，第二个履约周期覆盖年排放量约45亿吨二氧化碳，共有约3000家重点排放单位完成配额清缴，履约率达到99.5%以上，市场运行总体平稳。</p>
      
      <p>生态环境部应对气候变化司司长表示，全国碳市场第二个履约周期的顺利收官，标志着我国碳市场建设取得阶段性成果。与第一个履约周期相比，第二个履约周期在交易机制、数据质量管理、市场监管等方面都有明显改进。</p>
      
      <p>统计显示，第二个履约周期内，全国碳市场碳排放配额（CEA）累计成交量约2.2亿吨，累计成交额约96亿元。市场价格总体稳定在每吨60-70元区间，体现了市场对碳排放权价值的合理预期。</p>
      
      <p>下一步，生态环境部将稳步扩大全国碳市场覆盖行业范围，完善碳定价机制，加强数据质量管理，健全市场风险防控体系，推动全国碳市场健康发展。</p>`,
      aiAnalysis: `全国碳市场第二个履约周期的顺利收官，反映出我国在推进绿色低碳发展和应对气候变化方面的决心和成效，背后蕴含着几个重要信息：
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">1. 市场机制逐步成熟</strong> - 高履约率表明企业对碳市场的认可度和参与度显著提高，市场机制正在发挥作用，推动企业主动减排。</p>
      </div>
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">2. 数据质量不断提升</strong> - 碳市场的有效运行依赖于高质量的排放数据，履约周期的顺利完成表明我国在碳排放数据核算和监管方面的能力有所加强。</p>
      </div>
      
      <div class="pl-4 border-l-2 border-cyan-400/50">
        <p><strong class="text-white">3. 价格信号初步形成</strong> - 稳定的碳价格区间有助于企业形成稳定预期，引导社会资本投向低碳领域，促进绿色技术创新。</p>
      </div>
      
      <p>然而，我国碳市场仍处于发展初期，在覆盖行业范围、交易活跃度、价格发现机制等方面还有较大提升空间。未来随着市场机制的不断完善，碳市场在推动"双碳"目标实现中的作用将更加凸显。`
    }
  };
  
  // 新闻项点击事件
  newsItems.forEach(item => {
    item.addEventListener('click', function() {
      const newsId = this.getAttribute('data-id');
      const news = newsData[newsId];
      
      if (news) {
        // 更新详情内容
        document.getElementById('detail-title').textContent = news.title;
        document.getElementById('detail-date').textContent = news.date;
        document.getElementById('detail-source').textContent = news.source;
        document.getElementById('detail-region').textContent = news.region;
        document.getElementById('detail-views').textContent = `${news.views} 次浏览`;
        document.getElementById('detail-content').innerHTML = news.content;
        
        // 更新类型标签
        const typeElement = document.getElementById('detail-current-type');
        if (news.type === 'policy') {
          typeElement.className = 'px-2 py-0.5 bg-emerald-400/10 text-emerald-400 text-xs rounded-full';
          typeElement.textContent = '政策文件';
        } else {
          typeElement.className = 'px-2 py-0.5 bg-cyan-400/10 text-cyan-400 text-xs rounded-full';
          typeElement.textContent = '最新新闻';
        }
        
        // 显示详情，隐藏占位符
        newsDetailPlaceholder.classList.add('hidden');
        newsDetailContent.classList.remove('hidden');
        
        // 在移动视图下，滚动到详情区域
        if (window.innerWidth < 1024) {
          document.getElementById('news-detail-container').scrollIntoView({ behavior: 'smooth' });
        }
      }
    });
  });
  
  // 返回列表按钮
  backToListBtn.addEventListener('click', function() {
    newsDetailContent.classList.add('hidden');
    newsDetailPlaceholder.classList.remove('hidden');
    
    // 在移动视图下，滚动到列表区域
    if (window.innerWidth < 1024) {
      document.getElementById('news-list-container').scrollIntoView({ behavior: 'smooth' });
    }
  });
  
  // 刷新新闻
  refreshNewsBtn.addEventListener('click', function() {
    // 显示加载动画
    this.innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
    
    // 模拟刷新延迟
    setTimeout(() => {
      this.innerHTML = '<i class="fa fa-refresh"></i>';
      
      // 显示刷新提示
      showNotification('新闻已更新至最新', 'success');
    }, 1500);
  });
  
  // 自动刷新设置
  let autoRefreshInterval = null;
  autoRefreshSelect.addEventListener('change', function() {
    const interval = parseInt(this.value);
    
    // 清除现有定时器
    if (autoRefreshInterval) {
      clearInterval(autoRefreshInterval);
      autoRefreshInterval = null;
    }
    
    // 设置新定时器
    if (interval > 0) {
      autoRefreshInterval = setInterval(() => {
        // 模拟自动刷新
        refreshNewsBtn.click();
      }, interval * 1000);
      
      showNotification(`已设置每 ${interval/60} 分钟自动刷新`, 'info');
    } else {
      showNotification('已关闭自动刷新', 'info');
    }
  });
  
  // 加载更多新闻
  loadMoreNewsBtn.addEventListener('click', function() {
    this.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i> 加载中...';
    
    // 模拟加载延迟
    setTimeout(() => {
      this.innerHTML = '没有更多内容了';
      this.disabled = true;
      this.classList.add('opacity-50', 'cursor-not-allowed');
    }, 1500);
  });
  
  // 筛选功能
  function applyNewsFilters() {
    const type = newsTypeFilter.value;
    const time = newsTimeFilter.value;
    const region = newsRegionFilter.value;
    const search = newsSearchInput.value.toLowerCase();
    
    // 这里仅做UI状态反馈，实际应用中应根据筛选条件更新新闻列表
    showNotification('筛选条件已应用', 'info');
  }
  
  // 为筛选器添加事件监听
  newsTypeFilter.addEventListener('change', applyNewsFilters);
  newsTimeFilter.addEventListener('change', applyNewsFilters);
  newsRegionFilter.addEventListener('change', applyNewsFilters);
  newsSearchInput.addEventListener('keyup', function(e) {
    if (e.key === 'Enter') {
      applyNewsFilters();
    }
  });
  
  // 通知提示函数
  function showNotification(message, type = 'info') {
    // 检查是否已存在通知，若存在则移除
    const existingNotify = document.querySelector('.news-notification');
    if (existingNotify) {
      existingNotify.remove();
    }
    
    // 创建通知元素
    const notify = document.createElement('div');
    notify.className = `news-notification fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-[0_0_10px_rgba(0,255,255,0.2)] z-50 transition-all duration-300 transform translate-y-10 opacity-0`;
    
    // 根据类型设置样式
    if (type === 'success') {
      notify.classList.add('bg-emerald-400/10', 'text-emerald-400', 'border', 'border-emerald-400/20');
      notify.innerHTML = `<i class="fa fa-check-circle mr-2"></i> ${message}`;
    } else if (type === 'error') {
      notify.classList.add('bg-rose-400/10', 'text-rose-400', 'border', 'border-rose-400/20');
      notify.innerHTML = `<i class="fa fa-exclamation-circle mr-2"></i> ${message}`;
    } else {
      notify.classList.add('bg-cyan-400/10', 'text-cyan-400', 'border', 'border-cyan-400/20');
      notify.innerHTML = `<i class="fa fa-info-circle mr-2"></i> ${message}`;
    }
    
    // 添加到页面
    document.body.appendChild(notify);
    
    // 显示动画
    setTimeout(() => {
      notify.classList.remove('translate-y-10', 'opacity-0');
    }, 10);
    
    // 3秒后隐藏
    setTimeout(() => {
      notify.classList.add('translate-y-10', 'opacity-0');
      setTimeout(() => {
        notify.remove();
      }, 300);
    }, 3000);
  }
});
</script>


        <!-- 7. 用户反馈与讨论区页面 -->
        <div id="discussion-page" class="page-content hidden">
          <div class="mb-6">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">用户讨论区</h2>
            <p class="text-dark-100 mt-1">参与气候变化话题讨论，分享观点和见解</p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
              <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg mb-6">
                <div class="p-4 border-b border-dark-300">
                  <h3 class="font-semibold text-lg">发表新讨论</h3>
                </div>
                <div class="p-4">
                  <div class="space-y-4">
                    <input type="text" placeholder="讨论标题..." class="w-full bg-dark-300 border border-dark-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <textarea placeholder="分享您的观点..." rows="4" class="w-full bg-dark-300 border border-dark-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-primary/50"></textarea>
                    <div class="flex justify-between items-center">
                      <div class="flex items-center space-x-2">
                        <button class="text-dark-100 hover:text-white transition-colors">
                          <i class="fa fa-image"></i>
                        </button>
                        <button class="text-dark-100 hover:text-white transition-colors">
                          <i class="fa fa-link"></i>
                        </button>
                      </div>
                      <button class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                        发布讨论
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
                <div class="p-4 border-b border-dark-300 flex justify-between items-center">
                  <h3 class="font-semibold text-lg">热门讨论</h3>
                  <div class="flex items-center gap-2">
                    <button class="bg-primary/20 text-primary px-3 py-1 rounded text-sm">最新</button>
                    <button class="text-dark-100 hover:text-white px-3 py-1 rounded text-sm">热门</button>
                  </div>
                </div>
                <div class="divide-y divide-dark-300">
                  <div class="p-4 hover:bg-dark-300/20 transition-colors">
                    <div class="flex items-start space-x-3">
                      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary"></div>
                      <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-2">
                          <h4 class="font-medium text-white">环保小卫士</h4>
                          <span class="text-dark-100 text-sm">2小时前</span>
                        </div>
                        <h5 class="text-white mb-2">如何看待欧盟碳关税对发展中国家的影响？</h5>
                        <p class="text-dark-100 text-sm mb-3">欧盟CBAM机制可能会增加发展中国家的出口成本，是否会影响全国贸易公平性？大家怎么看？</p>
                        <div class="flex items-center justify-between">
                          <div class="flex items-center space-x-4">
                            <button class="flex items-center space-x-1 text-dark-100 hover:text-primary transition-colors">
                              <i class="fa fa-thumbs-up"></i>
                              <span class="text-sm">24</span>
                            </button>
                            <button class="flex items-center space-x-1 text-dark-100 hover:text-secondary transition-colors">
                              <i class="fa fa-comment"></i>
                              <span class="text-sm">12</span>
                            </button>
                            <button class="flex items-center space-x-1 text-dark-100 hover:text-warning transition-colors">
                              <i class="fa fa-share"></i>
                              <span class="text-sm">5</span>
                            </button>
                          </div>
                          <span class="bg-warning/10 text-warning text-xs px-2 py-1 rounded">政策讨论</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="p-4 hover:bg-dark-300/20 transition-colors">
                    <div class="flex items-start space-x-3">
                      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-secondary to-accent"></div>
                      <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-2">
                          <h4 class="font-medium text-white">气候研究员</h4>
                          <span class="text-dark-100 text-sm">4小时前</span>
                        </div>
                        <h5 class="text-white mb-2">亚马逊森林火灾的长期环境影响分析</h5>
                        <p class="text-dark-100 text-sm mb-3">从生态系统角度分析，此次火灾可能会对全国碳循环产生什么影响？</p>
                        <div class="flex items-center justify-between">
                          <div class="flex items-center space-x-4">
                            <button class="flex items-center space-x-1 text-dark-100 hover:text-primary transition-colors">
                              <i class="fa fa-thumbs-up"></i>
                              <span class="text-sm">18</span>
                            </button>
                            <button class="flex items-center space-x-1 text-dark-100 hover:text-secondary transition-colors">
                              <i class="fa fa-comment"></i>
                              <span class="text-sm">8</span>
                            </button>
                            <button class="flex items-center space-x-1 text-dark-100 hover:text-warning transition-colors">
                              <i class="fa fa-share"></i>
                              <span class="text-sm">3</span>
                            </button>
                          </div>
                          <span class="bg-danger/10 text-danger text-xs px-2 py-1 rounded">环境灾害</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
                <div class="p-4 border-b border-dark-300">
                  <h3 class="font-semibold text-lg">活跃用户</h3>
                </div>
                <div class="p-4 space-y-3">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary"></div>
                      <div>
                        <h4 class="font-medium text-sm">环保小卫士</h4>
                        <p class="text-xs text-dark-100">92 讨论</p>
                      </div>
                    </div>
                    <span class="bg-primary/20 text-primary text-xs px-2 py-1 rounded">活跃</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-secondary to-accent"></div>
                      <div>
                        <h4 class="font-medium text-sm">气候研究员</h4>
                        <p class="text-xs text-dark-100">76 讨论</p>
                      </div>
                    </div>
                    <span class="bg-secondary/20 text-secondary text-xs px-2 py-1 rounded">专家</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-accent to-warning"></div>
                      <div>
                        <h4 class="font-medium text-sm">绿色地球</h4>
                        <p class="text-xs text-dark-100">54 讨论</p>
                      </div>
                    </div>
                    <span class="bg-success/20 text-success text-xs px-2 py-1 rounded">新星</span>
                  </div>
                </div>
              </div>

              <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
                <div class="p-4 border-b border-dark-300">
                  <h3 class="font-semibold text-lg">热门话题</h3>
                </div>
                <div class="p-4 space-y-2">
                  <div class="flex items-center justify-between">
                    <span class="bg-primary/10 text-primary text-sm px-2 py-1 rounded">#碳中和</span>
                    <span class="text-dark-100 text-sm">128 讨论</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="bg-danger/10 text-danger text-sm px-2 py-1 rounded">#森林火灾</span>
                    <span class="text-dark-100 text-sm">96 讨论</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="bg-warning/10 text-warning text-sm px-2 py-1 rounded">#碳关税</span>
                    <span class="text-dark-100 text-sm">74 讨论</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="bg-secondary/10 text-secondary text-sm px-2 py-1 rounded">#可再生能源</span>
                    <span class="text-dark-100 text-sm">58 讨论</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 8. 数据下载与分享页面 -->
        <div id="download-share-page" class="page-content hidden">
          <div class="mb-6">
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-white">数据下载与分享</h2>
            <p class="text-dark-100 mt-1">下载分析数据或分享至社交平台</p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
              <div class="p-4 border-b border-dark-300">
                <h3 class="font-semibold text-lg">数据下载</h3>
              </div>
              <div class="p-4 space-y-4">
                <div class="bg-dark-300/30 rounded-lg p-4 hover:bg-dark-300/50 transition-colors cursor-pointer">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-3">
                      <i class="fa fa-file-excel-o text-success text-xl"></i>
                      <div>
                        <h4 class="font-medium text-white">舆情数据总览</h4>
                        <p class="text-dark-100 text-sm">包含近30天全国舆情统计数据</p>
                      </div>
                    </div>
                    <button class="bg-success hover:bg-success/90 text-white px-3 py-1 rounded text-sm transition-colors">
                      <i class="fa fa-download mr-1"></i>下载
                    </button>
                  </div>
                  <div class="text-xs text-dark-100">
                    <span>格式: Excel | 大小: 2.4MB | 更新: 2025-07-16</span>
                  </div>
                </div>

                <div class="bg-dark-300/30 rounded-lg p-4 hover:bg-dark-300/50 transition-colors cursor-pointer">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-3">
                      <i class="fa fa-file-text-o text-primary text-xl"></i>
                      <div>
                        <h4 class="font-medium text-white">热点话题分析报告</h4>
                        <p class="text-dark-100 text-sm">详细的主题分类和情感分析报告</p>
                      </div>
                    </div>
                    <button class="bg-primary hover:bg-primary/90 text-white px-3 py-1 rounded text-sm transition-colors">
                      <i class="fa fa-download mr-1"></i>下载
                    </button>
                  </div>
                  <div class="text-xs text-dark-100">
                    <span>格式: PDF | 大小: 5.8MB | 更新: 2025-07-16</span>
                  </div>
                </div>

                <div class="bg-dark-300/30 rounded-lg p-4 hover:bg-dark-300/50 transition-colors cursor-pointer">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-3">
                      <i class="fa fa-database text-secondary text-xl"></i>
                      <div>
                        <h4 class="font-medium text-white">原始数据集</h4>
                        <p class="text-dark-100 text-sm">用于研究的完整原始数据</p>
                      </div>
                    </div>
                    <button class="bg-secondary hover:bg-secondary/90 text-white px-3 py-1 rounded text-sm transition-colors">
                      <i class="fa fa-download mr-1"></i>下载
                    </button>
                  </div>
                  <div class="text-xs text-dark-100">
                    <span>格式: JSON | 大小: 15.2MB | 更新: 2025-07-16</span>
                  </div>
                </div>

                <div class="bg-dark-300/30 rounded-lg p-4 hover:bg-dark-300/50 transition-colors cursor-pointer">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-3">
                      <i class="fa fa-line-chart text-warning text-xl"></i>
                      <div>
                        <h4 class="font-medium text-white">可视化图表包</h4>
                        <p class="text-dark-100 text-sm">高清图表文件，适合报告使用</p>
                      </div>
                    </div>
                    <button class="bg-warning hover:bg-warning/90 text-white px-3 py-1 rounded text-sm transition-colors">
                      <i class="fa fa-download mr-1"></i>下载
                    </button>
                  </div>
                  <div class="text-xs text-dark-100">
                    <span>格式: PNG/SVG | 大小: 8.7MB | 更新: 2025-07-16</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-dark-400 rounded-xl border border-dark-300 overflow-hidden shadow-lg">
              <div class="p-4 border-b border-dark-300">
                <h3 class="font-semibold text-lg">社交分享</h3>
              </div>
              <div class="p-4 space-y-4">
                <div class="bg-dark-300/30 rounded-lg p-4">
                  <h4 class="font-medium text-white mb-3">生成分享卡片</h4>
                  <div class="space-y-3">
                    <select class="w-full bg-dark-300 border border-dark-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-primary/50">
                      <option>选择分享内容</option>
                      <option>舆情热度趋势</option>
                      <option>主题分布统计</option>
                      <option>地区热力图</option>
                      <option>自定义内容</option>
                    </select>
                    <div class="grid grid-cols-2 gap-2">
                      <button class="bg-primary hover:bg-primary/90 text-white px-3 py-2 rounded text-sm transition-colors">
                        <i class="fa fa-image mr-1"></i>生成卡片
                      </button>
                      <button class="bg-secondary hover:bg-secondary/90 text-white px-3 py-2 rounded text-sm transition-colors">
                        <i class="fa fa-eye mr-1"></i>预览
                      </button>
                    </div>
                  </div>
                </div>

                <div class="space-y-3">
                  <h4 class="font-medium text-white">分享到平台</h4>
                  <div class="grid grid-cols-2 gap-3">
                    <button class="flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition-colors">
                      <i class="fa fa-twitter"></i>
                      <span>微博</span>
                    </button>
                    <button class="flex items-center justify-center space-x-2 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition-colors">
                      <i class="fa fa-wechat"></i>
                      <span>微信</span>
                    </button>
                    <button class="flex items-center justify-center space-x-2 bg-blue-800 hover:bg-blue-900 text-white px-4 py-3 rounded-lg transition-colors">
                      <i class="fa fa-linkedin"></i>
                      <span>LinkedIn</span>
                    </button>
                    <button class="flex items-center justify-center space-x-2 bg-gray-700 hover:bg-gray-800 text-white px-4 py-3 rounded-lg transition-colors">
                      <i class="fa fa-envelope"></i>
                      <span>邮件</span>
                    </button>
                  </div>
                </div>

                <div class="bg-dark-300/30 rounded-lg p-4">
                  <h4 class="font-medium text-white mb-3">分享链接</h4>
                  <div class="flex space-x-2">
                    <input type="text" value="https://climate-dashboard.com/share/abc123" readonly class="flex-1 bg-dark-300 border border-dark-200 rounded-lg py-2 px-3 text-sm">
                    <button class="bg-primary hover:bg-primary/90 text-white px-3 py-2 rounded text-sm transition-colors">
                      <i class="fa fa-copy"></i>
                    </button>
                  </div>
                  <p class="text-xs text-dark-100 mt-2">此链接将展示当前页面的实时数据快照</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 9. AI未来话题预测页面 -->
<!-- 9. AI辅助分析/预测页面 -->
<div id="future-topic-page" class="page-content hidden min-h-screen bg-gradient-to-b from-gray-950 to-gray-900 text-gray-100">
  <!-- 页面头部 -->
  <header class="relative py-6 px-4 md:px-8 lg:px-16 overflow-hidden">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(66,153,225,0.15),transparent_40%)]"></div>
    <div class="container mx-auto relative z-10">
      <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-white tracking-tight">
        <span class="text-blue-400">AI</span> 辅助分析与预测
      </h2>
      <p class="text-gray-300 mt-2 max-w-2xl">基于现有数据，通过智能模型提供趋势分析与决策参考，助力精准判断与响应</p>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="container mx-auto px-4 md:px-8 lg:px-16 py-6 grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- 左侧主内容 -->
    <div class="lg:col-span-3 space-y-8">
      <!-- 场景选择区 -->
      <section class="bg-gray-900/50 backdrop-blur-sm rounded-xl p-6 border border-gray-800 shadow-[0_0_30px_rgba(0,0,0,0.3)] transition-all duration-300 hover:border-blue-500/30">
        <h3 class="text-xl font-semibold mb-4 flex items-center">
          <i class="fa fa-sitemap text-blue-400 mr-2"></i>分析场景选择
        </h3>
        <div class="relative">
          <select id="analysis-scenario" class="w-full bg-gray-800 border border-gray-700 rounded-lg py-3 px-4 pr-10 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
            <option value="trend-prediction">未来7天舆情热度趋势预测</option>
            <option value="topic-analysis">某主题讨论热度变化原因分析</option>
            <option value="sentiment-alert">情感倾向转变预警</option>
          </select>
          <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
            <i class="fa fa-chevron-down text-gray-400"></i>
          </div>
        </div>
        
        <!-- 主题选择（场景2专用） -->
        <div id="topic-selector" class="mt-4 hidden">
          <label class="block text-sm font-medium text-gray-300 mb-2">选择分析主题</label>
          <div class="flex flex-wrap gap-2">
            <button class="topic-btn bg-gray-800 hover:bg-blue-900/50 border border-gray-700 hover:border-blue-500 px-4 py-2 rounded-lg text-sm transition-all">极端天气</button>
            <button class="topic-btn bg-gray-800 hover:bg-blue-900/50 border border-gray-700 hover:border-blue-500 px-4 py-2 rounded-lg text-sm transition-all">节能减排</button>
            <button class="topic-btn bg-gray-800 hover:bg-blue-900/50 border border-gray-700 hover:border-blue-500 px-4 py-2 rounded-lg text-sm transition-all">气候变化</button>
            <button class="topic-btn bg-gray-800 hover:bg-blue-900/50 border border-gray-700 hover:border-blue-500 px-4 py-2 rounded-lg text-sm transition-all">环境保护</button>
          </div>
        </div>
      </section>

      <!-- 分析结果展示区 -->
      <section class="bg-gray-900/50 backdrop-blur-sm rounded-xl p-6 border border-gray-800 shadow-[0_0_30px_rgba(0,0,0,0.3)] transition-all duration-300">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-semibold flex items-center">
            <i class="fa fa-bar-chart text-blue-400 mr-2"></i>分析结果
          </h3>
          <div class="flex items-center text-sm text-gray-400">
            <span class="mr-2">更新于：</span>
            <span id="result-update-time">2023-08-03 14:30</span>
          </div>
        </div>

        <!-- 场景1：趋势预测结果 -->
        <div id="trend-prediction-result" class="analysis-result">
          <div class="h-[350px] relative">
            <canvas id="trend-chart"></canvas>
            <!-- 加载动画 -->
            <div class="absolute inset-0 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm rounded-lg opacity-0 pointer-events-none transition-opacity duration-300" id="chart-loading">
              <div class="flex flex-col items-center">
                <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                <span class="mt-3 text-gray-300">生成预测中...</span>
              </div>
            </div>
          </div>
          
          <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
              <h4 class="font-medium text-gray-300 mb-2">预测依据</h4>
              <p class="text-sm text-gray-400">基于近30天历史数据的趋势推算，综合考虑了季节性因素和历史相似周期模式</p>
            </div>
            <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
              <h4 class="font-medium text-gray-300 mb-2">预测置信度</h4>
              <div class="flex items-center">
                <span class="text-yellow-400 mr-2">中等</span>
                <div class="w-full bg-gray-700 rounded-full h-2">
                  <div class="bg-yellow-400 h-2 rounded-full" style="width: 65%"></div>
                </div>
                <span class="ml-2 text-sm text-gray-400">65%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 场景2：主题分析结果 -->
        <div id="topic-analysis-result" class="analysis-result hidden">
          <div class="bg-blue-900/20 border border-blue-800/50 rounded-lg p-4 mb-6">
            <h4 class="font-medium text-blue-300 flex items-center">
              <i class="fa fa-info-circle mr-2"></i>分析主题：<span id="current-topic">极端天气</span>
            </h4>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <h4 class="font-medium text-gray-300 mb-3">热度变化趋势</h4>
              <div class="h-[200px]">
                <canvas id="topic-trend-chart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-medium text-gray-300 mb-3">关键时间节点</h4>
              <div class="space-y-4">
                <div class="bg-gray-800/50 p-3 rounded-lg border border-gray-700">
                  <div class="flex justify-between items-start">
                    <span class="text-sm font-medium">8月1日</span>
                    <span class="bg-green-500/20 text-green-400 text-xs px-2 py-1 rounded-full">突增</span>
                  </div>
                  <p class="text-sm text-gray-400 mt-1">某环保政策发布后，讨论量增长200%</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded-lg border border-gray-700">
                  <div class="flex justify-between items-start">
                    <span class="text-sm font-medium">7月25日</span>
                    <span class="bg-red-500/20 text-red-400 text-xs px-2 py-1 rounded-full">突降</span>
                  </div>
                  <p class="text-sm text-gray-400 mt-1">热门事件转移，讨论量下降45%</p>
                </div>
              </div>
            </div>
          </div>
          
          <div>
            <h4 class="font-medium text-gray-300 mb-3">核心驱动来源</h4>
            <div class="h-[200px]">
              <canvas id="drivers-chart"></canvas>
            </div>
          </div>
        </div>

        <!-- 场景3：情感预警结果 -->
        <div id="sentiment-alert-result" class="analysis-result hidden">
          <div class="mb-6">
            <h4 class="font-medium text-gray-300 mb-3">近30天情感变化趋势</h4>
            <div class="h-[300px]">
              <canvas id="sentiment-chart"></canvas>
            </div>
          </div>
          
          <!-- 预警提示 -->
          <div class="bg-red-900/20 border border-red-800/50 rounded-lg p-4 mb-6 animate-pulse">
            <div class="flex items-start">
              <div class="bg-red-500/20 p-2 rounded-full mr-3">
                <i class="fa fa-exclamation-triangle text-red-400"></i>
              </div>
              <div>
                <h4 class="font-medium text-red-300">预警：负面情绪上升</h4>
                <p class="text-sm text-gray-300 mt-1">"极端天气"相关负面情绪近3天上升15%，建议关注公众关切点并及时回应</p>
                <div class="mt-3">
                  <a href="#sentiment-page" class="text-blue-400 hover:text-blue-300 text-sm flex items-center">
                    查看情感分析详情 <i class="fa fa-arrow-right ml-1"></i>
                  </a>
                  <a href="#data-page" class="text-blue-400 hover:text-blue-300 text-sm flex items-center mt-1">
                    查看原始数据 <i class="fa fa-arrow-right ml-1"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 text-center">
              <div class="text-2xl font-bold text-green-400">42%</div>
              <div class="text-sm text-gray-400 mt-1">正面情绪占比</div>
            </div>
            <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 text-center">
              <div class="text-2xl font-bold text-yellow-400">33%</div>
              <div class="text-sm text-gray-400 mt-1">中性情绪占比</div>
            </div>
            <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 text-center">
              <div class="text-2xl font-bold text-red-400">25%</div>
              <div class="text-sm text-gray-400 mt-1">负面情绪占比</div>
            </div>
          </div>
        </div>
      </section>

      <!-- AI问答交互区 -->
      <section class="bg-gray-900/50 backdrop-blur-sm rounded-xl p-6 border border-gray-800 shadow-[0_0_30px_rgba(0,0,0,0.3)] transition-all duration-300">
        <h3 class="text-xl font-semibold mb-4 flex items-center">
          <i class="fa fa-comments text-blue-400 mr-2"></i>AI智能问答
        </h3>
        
        <div class="mb-4">
          <p class="text-sm text-gray-400 mb-3">输入问题，获取舆情相关分析（示例："近一周哪些地区讨论极端天气最多？"）</p>
          
          <!-- 问答历史 -->
          <div id="chat-history" class="bg-gray-800/50 rounded-lg p-4 h-[300px] overflow-y-auto mb-4 space-y-4">
            <!-- 调整为：提问在右，回答在左 -->
            <div class="flex items-start justify-end">
              <div class="bg-gray-700/50 rounded-lg rounded-tr-none px-4 py-2 max-w-[80%]">
                <p class="text-sm">近一周哪些地区讨论极端天气最多？</p>
              </div>
              <div class="bg-blue-500 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 ml-3">
                <i class="fa fa-user text-white text-sm"></i>
              </div>
            </div>
            <div class="flex items-start">
              <div class="bg-blue-600 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 mr-3 relative group">
                <i class="fa fa-robot text-white text-sm"></i>
                <!-- AI状态动画 -->
                <div class="absolute inset-0 bg-blue-400/30 rounded-full opacity-0 group-hover:opacity-100 animate-ping"></div>
              </div>
              <div class="bg-blue-900/50 rounded-lg rounded-tl-none px-4 py-2 max-w-[80%]">
                <p class="text-sm">根据近一周数据统计，讨论极端天气最多的三个地区分别是：广东省（18.2%）、江苏省（15.7%）和浙江省（12.3%），主要与近期台风活动相关。</p>
              </div>
            </div>
          </div>
          
          <!-- 输入区域 -->
          <div class="relative">
            <input type="text" id="question-input" placeholder="请输入您的问题..." class="w-full bg-gray-800 border border-gray-700 rounded-lg py-3 px-4 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm">
            <button id="send-question" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 hover:bg-blue-500 text-white p-1.5 rounded-lg transition-all">
              <i class="fa fa-paper-plane"></i>
            </button>
          </div>
          
          <!-- 流式回答指示器 (AI接入后使用) -->
          <div id="streaming-indicator" class="hidden mt-3 flex items-center text-sm text-gray-400">
            <div class="flex space-x-1 mr-2">
              <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
              <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
              <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
            </div>
            <span>AI正在生成回答...</span>
          </div>
        </div>
        
        <!-- 快速问题 -->
        <div>
          <p class="text-sm text-gray-400 mb-2">热门问题：</p>
          <div class="flex flex-wrap gap-2">
            <button class="quick-question bg-gray-800 hover:bg-gray-700 text-xs px-3 py-1 rounded-full transition-all">未来三天舆情热度会上升吗？</button>
            <button class="quick-question bg-gray-800 hover:bg-gray-700 text-xs px-3 py-1 rounded-full transition-all">哪些人群最关注气候变化？</button>
            <button class="quick-question bg-gray-800 hover:bg-gray-700 text-xs px-3 py-1 rounded-full transition-all">近期环保政策有何影响？</button>
          </div>
        </div>
      </section>
    </div>

    <!-- 右侧功能说明区 -->
    <div class="lg:col-span-1">
      <div class="sticky top-6 bg-gray-900/50 backdrop-blur-sm rounded-xl p-6 border border-gray-800 shadow-[0_0_30px_rgba(0,0,0,0.3)] transition-all duration-300 hover:border-blue-500/30">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-blue-900/30 flex items-center justify-center mr-3 relative">
            <i class="fa fa-lightbulb-o text-blue-400"></i>
            <!-- 科技感动画效果 -->
            <div class="absolute -inset-1 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full blur opacity-30 animate-pulse"></div>
          </div>
          <h3 class="text-lg font-semibold">功能说明</h3>
        </div>
        
        <div class="space-y-4 text-sm text-gray-300">
          <p>本页面提供基于数据的智能分析与预测功能，帮助您把握舆情动态与发展趋势。</p>
          
          <div class="pt-4 border-t border-gray-800">
            <h4 class="font-medium text-blue-300 mb-2">AI接入指南</h4>
            <div class="bg-gray-800/30 p-3 rounded-lg text-xs text-gray-400">
              <p class="mb-2"><span class="text-blue-400">// 后端接入示例</span></p>
              <p>1. 实现WebSocket连接处理流式响应</p>
              <p>2. 调用streamingAnswer()函数处理实时数据</p>
              <p>3. 通过updateAIStatus()更新连接状态</p>
            </div>
          </div>
          
          <div class="pt-4 border-t border-gray-800">
            <h4 class="font-medium text-blue-300 mb-2">未来迭代</h4>
            <ul class="list-disc list-inside text-gray-400 space-y-1 pl-2">
              <li>接入深度学习模型提升预测精度</li>
              <li>增加实时数据处理与分析能力</li>
              <li>优化自然语言理解与交互体验</li>
              <li>提供定制化分析报告生成功能</li>
            </ul>
          </div>
          
          <div class="pt-4 border-t border-gray-800">
            <h4 class="font-medium text-blue-300 mb-2">AI接口状态</h4>
            <div class="flex items-center">
              <span class="inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-pulse"></span>
              <span class="text-gray-400">准备中，预留接入空间</span>
            </div>
          </div>
        </div>
        
        <!-- AI接入状态指示器 -->
        <div class="mt-6 pt-4 border-t border-gray-800">
          <div class="flex justify-between items-center mb-2">
            <span class="text-xs text-gray-400">AI服务连接状态</span>
            <span id="ai-status" class="text-xs bg-gray-700 text-gray-300 px-2 py-0.5 rounded-full">未连接</span>
          </div>
          <div class="w-full bg-gray-800 rounded-full h-1.5">
            <div class="bg-blue-500 h-1.5 rounded-full transition-all duration-1000" style="width: 0%" id="ai-connection-progress"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="mt-12 py-6 px-4 md:px-8 lg:px-16 border-t border-gray-800">
    <div class="container mx-auto text-center text-sm text-gray-500">
      <p>AI辅助分析工具 © 2023 | 数据更新周期：每日凌晨2点</p>
    </div>
  </footer>
</div>

<script>
// 场景切换逻辑
document.getElementById('analysis-scenario').addEventListener('change', function() {
  const scenario = this.value;
  
  // 隐藏所有结果
  document.querySelectorAll('.analysis-result').forEach(el => {
    el.classList.add('hidden');
  });
  
  // 显示选中场景的结果
  document.getElementById(`${scenario}-result`).classList.remove('hidden');
  
  // 特殊处理主题选择器显示
  if (scenario === 'topic-analysis') {
    document.getElementById('topic-selector').classList.remove('hidden');
  } else {
    document.getElementById('topic-selector').classList.add('hidden');
  }
  
  // 显示加载动画并重新绘制图表
  if (scenario === 'trend-prediction') {
    showChartLoading();
    setTimeout(() => {
      drawTrendChart();
      hideChartLoading();
    }, 800);
  } else if (scenario === 'topic-analysis') {
    drawTopicTrendChart();
    drawDriversChart();
  } else if (scenario === 'sentiment-alert') {
    drawSentimentChart();
  }
});

// 主题选择逻辑
document.querySelectorAll('.topic-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    // 移除所有按钮的选中状态
    document.querySelectorAll('.topic-btn').forEach(b => {
      b.classList.remove('bg-blue-900/50', 'border-blue-500');
      b.classList.add('bg-gray-800', 'border-gray-700');
    });
    
    // 添加当前按钮的选中状态
    this.classList.remove('bg-gray-800', 'border-gray-700');
    this.classList.add('bg-blue-900/50', 'border-blue-500');
    
    // 更新显示的主题
    document.getElementById('current-topic').textContent = this.textContent;
    
    // 重新绘制图表
    drawTopicTrendChart();
    drawDriversChart();
  });
});

// 问答功能
document.getElementById('send-question').addEventListener('click', sendQuestion);
document.getElementById('question-input').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendQuestion();
  }
});

// 快速问题点击
document.querySelectorAll('.quick-question').forEach(btn => {
  btn.addEventListener('click', function() {
    document.getElementById('question-input').value = this.textContent;
    sendQuestion();
  });
});

function sendQuestion() {
  const input = document.getElementById('question-input');
  const question = input.value.trim();
  
  if (!question) return;
  
  // 添加用户问题到历史记录（右侧）
  const history = document.getElementById('chat-history');
  history.innerHTML += `
    <div class="flex items-start justify-end">
      <div class="bg-gray-700/50 rounded-lg rounded-tr-none px-4 py-2 max-w-[80%]">
        <p class="text-sm">${question}</p>
      </div>
      <div class="bg-blue-500 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 ml-3">
        <i class="fa fa-user text-white text-sm"></i>
      </div>
    </div>
  `;
  
  // 清空输入框
  input.value = '';
  
  // 显示流式加载指示器
  document.getElementById('streaming-indicator').classList.remove('hidden');
  
  // 滚动到底部
  history.scrollTop = history.scrollHeight;
  
  // 模拟AI连接过程
  simulateAIConnection();
  
  // 模拟AI流式回答
  setTimeout(() => {
    // 生成回答（实际项目中这里会调用AI接口）
    const answer = generateAnswer(question);
    
    // 模拟流式输出效果
    streamAnswer(answer);
  }, 1000);
}

// 生成预设回答（实际项目中替换为AI接口调用）
function generateAnswer(question) {
  const answers = [
    "根据分析，该主题的讨论热度在未来一周可能保持稳定，预计波动幅度不会超过10%。",
    "数据显示，该地区的讨论主要集中在中青年群体，占比约68%，其中25-35岁年龄段最为活跃。",
    "近期相关政策发布后，正面情绪占比上升了12个百分点，公众对政策持积极态度。",
    "根据历史数据对比，当前的舆情趋势与去年同期相似，预计将在未来两周内达到峰值。",
    "主要讨论渠道分布：社交媒体占比52%，新闻评论区占比31%，论坛讨论占比17%。",
    "分析发现，该话题的讨论热度与近期天气变化呈现较强相关性，相关系数为0.78。"
  ];
  
  // 简单的关键词匹配，实际项目中可扩展
  if (question.includes("地区")) {
    return "根据近一周数据统计，讨论热度最高的三个地区分别是：广东省（18.2%）、江苏省（15.7%）和浙江省（12.3%）。";
  } else if (question.includes("人群") || question.includes("年龄")) {
    return "关注该话题的人群中，25-40岁年龄段占比最高，达到53%，其次是40-55岁年龄段，占比28%。";
  } else if (question.includes("政策")) {
    return "近期发布的环保政策在舆情中获得了广泛关注，正面评价占比67%，主要集中在政策的可行性和长远影响方面。";
  }
  
  // 随机返回一个预设回答
  return answers[Math.floor(Math.random() * answers.length)];
}

// 流式输出回答
function streamAnswer(fullAnswer) {
  const history = document.getElementById('chat-history');
  const streamingIndicator = document.getElementById('streaming-indicator');
  
  // 创建AI回答容器
  const answerId = `ai-answer-${Date.now()}`;
  history.innerHTML += `
    <div class="flex items-start" id="${answerId}-container">
      <div class="bg-blue-600 rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 mr-3 relative group">
        <i class="fa fa-robot text-white text-sm"></i>
        <div class="absolute inset-0 bg-blue-400/30 rounded-full opacity-0 group-hover:opacity-100 animate-ping"></div>
      </div>
      <div class="bg-blue-900/50 rounded-lg rounded-tl-none px-4 py-2 max-w-[80%]">
        <p class="text-sm" id="${answerId}"></p>
      </div>
    </div>
  `;
  
  const answerElement = document.getElementById(answerId);
  let currentIndex = 0;
  
  // 滚动到底部
  history.scrollTop = history.scrollHeight;
  
  // 模拟流式输出
  const interval = setInterval(() => {
    if (currentIndex < fullAnswer.length) {
      // 每次添加1-3个字符，模拟真实打字效果
      const charsToAdd = Math.min(3, fullAnswer.length - currentIndex);
      answerElement.textContent += fullAnswer.substr(currentIndex, charsToAdd);
      currentIndex += charsToAdd;
      history.scrollTop = history.scrollHeight;
    } else {
      clearInterval(interval);
      streamingIndicator.classList.add('hidden');
      // 模拟AI处理完成
      updateAIStatus('就绪');
    }
  }, 30);
}

// 模拟AI连接过程
function simulateAIConnection() {
  updateAIStatus('连接中');
  
  // 模拟连接进度
  let progress = 0;
  const progressBar = document.getElementById('ai-connection-progress');
  const interval = setInterval(() => {
    progress += Math.random() * 10;
    if (progress >= 100) {
      progress = 100;
      clearInterval(interval);
      setTimeout(() => {
        updateAIStatus('处理中');
      }, 500);
    }
    progressBar.style.width = `${progress}%`;
  }, 200);
}

// 更新AI状态
function updateAIStatus(status) {
  const statusElement = document.getElementById('ai-status');
  
  // 移除所有状态类
  statusElement.className = 'text-xs px-2 py-0.5 rounded-full';
  
  switch(status) {
    case '未连接':
      statusElement.classList.add('bg-gray-700', 'text-gray-300');
      break;
    case '连接中':
      statusElement.classList.add('bg-yellow-900/50', 'text-yellow-300');
      break;
    case '处理中':
      statusElement.classList.add('bg-blue-900/50', 'text-blue-300');
      break;
    case '就绪':
      statusElement.classList.add('bg-green-900/50', 'text-green-300');
      // 2秒后恢复就绪状态
      setTimeout(() => {
        statusElement.classList.remove('bg-green-900/50', 'text-green-300');
        statusElement.classList.add('bg-gray-700', 'text-gray-300');
        statusElement.textContent = '就绪';
        document.getElementById('ai-connection-progress').style.width = '100%';
      }, 2000);
      break;
    default:
      statusElement.classList.add('bg-gray-700', 'text-gray-300');
  }
  
  statusElement.textContent = status;
}

// 图表加载动画
function showChartLoading() {
  document.getElementById('chart-loading').classList.remove('opacity-0', 'pointer-events-none');
}

function hideChartLoading() {
  document.getElementById('chart-loading').classList.add('opacity-0', 'pointer-events-none');
}

// 趋势预测图表
function drawTrendChart() {
  const ctx = document.getElementById('trend-chart').getContext('2d');
  
  // 生成未来7天的日期
  const dates = [];
  const today = new Date();
  for (let i = 1; i <= 7; i++) {
    const date = new Date(today);
    date.setDate(today.getDate() + i);
    dates.push(`${date.getMonth() + 1}/${date.getDate()}`);
  }
  
  // 生成模拟数据
  const baseValue = 65;
  const values = dates.map((_, i) => {
    // 模拟增长趋势，加入一些随机波动
    return baseValue + (i * 2) + (Math.random() * 10 - 5);
  });
  
  // 销毁已存在的图表
  if (window.trendChartInstance) {
    window.trendChartInstance.destroy();
  }
  
  // 创建新图表
  window.trendChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        label: '预测热度指数',
        data: values,
        borderColor: '#3B82F6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        borderWidth: 2,
        tension: 0.4,
        fill: true,
        pointBackgroundColor: '#3B82F6',
        pointRadius: 4,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        duration: 1000,
        easing: 'easeOutQuart'
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.7)'
          }
        },
        y: {
          beginAtZero: false,
          min: Math.min(...values) - 10,
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.7)'
          }
        }
      },
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(17, 24, 39, 0.9)',
          titleColor: 'rgba(255, 255, 255, 0.9)',
          bodyColor: 'rgba(255, 255, 255, 0.7)',
          borderColor: 'rgba(59, 130, 246, 0.3)',
          borderWidth: 1,
          padding: 10,
          cornerRadius: 6
        }
      }
    }
  });
}

// 主题趋势图表
function drawTopicTrendChart() {
  const ctx = document.getElementById('topic-trend-chart').getContext('2d');
  
  // 生成过去14天的日期
  const dates = [];
  const today = new Date();
  for (let i = 13; i >= 0; i--) {
    const date = new Date(today);
    date.setDate(today.getDate() - i);
    dates.push(`${date.getMonth() + 1}/${date.getDate()}`);
  }
  
  // 生成模拟数据（带突增突降点）
  const values = [];
  let baseValue = 30;
  
  dates.forEach((date, i) => {
    // 模拟正常波动
    baseValue += (Math.random() * 8 - 4);
    
    // 模拟8月1日的突增
    if (i === 9) {
      baseValue *= 2;
    }
    
    // 模拟7月25日的突降
    if (i === 3) {
      baseValue *= 0.55;
    }
    
    values.push(Math.max(10, Math.round(baseValue)));
  });
  
  // 销毁已存在的图表
  if (window.topicTrendChartInstance) {
    window.topicTrendChartInstance.destroy();
  }
  
  // 创建新图表
  window.topicTrendChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        label: '讨论热度',
        data: values,
        borderColor: '#60A5FA',
        backgroundColor: 'rgba(96, 165, 250, 0.1)',
        borderWidth: 2,
        tension: 0.3,
        fill: true,
        pointBackgroundColor: '#60A5FA',
        pointRadius: 3,
        pointHoverRadius: 5
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        duration: 800
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            maxRotation: 0,
            font: {
              size: 10
            }
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            font: {
              size: 10
            }
          }
        }
      },
      plugins: {
        legend: {
          display: false
        }
      }
    }
  });
}

// 驱动来源图表
function drawDriversChart() {
  const ctx = document.getElementById('drivers-chart').getContext('2d');
  
  // 销毁已存在的图表
  if (window.driversChartInstance) {
    window.driversChartInstance.destroy();
  }
  
  // 创建新图表
  window.driversChartInstance = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['新闻报道', '社交媒体', '专家分析', '用户讨论'],
      datasets: [{
        data: [60, 25, 8, 7],
        backgroundColor: [
          'rgba(59, 130, 246, 0.8)',
          'rgba(93, 99, 238, 0.8)',
          'rgba(139, 92, 246, 0.8)',
          'rgba(192, 132, 252, 0.8)'
        ],
        borderColor: [
          'rgba(59, 130, 246, 1)',
          'rgba(93, 99, 238, 1)',
          'rgba(139, 92, 246, 1)',
          'rgba(192, 132, 252, 1)'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        animateRotate: true,
        animateScale: true,
        duration: 800
      },
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: 'rgba(255, 255, 255, 0.7)',
            padding: 15,
            font: {
              size: 11
            }
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.label}: ${context.raw}%`;
            }
          }
        }
      },
      cutout: '65%'
    }
  });
}

// 情感分析图表
function drawSentimentChart() {
  const ctx = document.getElementById('sentiment-chart').getContext('2d');
  
  // 生成过去30天的日期
  const dates = [];
  const today = new Date();
  for (let i = 29; i >= 0; i--) {
    const date = new Date(today);
    date.setDate(today.getDate() - i);
    dates.push(`${date.getMonth() + 1}/${date.getDate()}`);
  }
  
  // 生成模拟数据
  const positive = [];
  const neutral = [];
  const negative = [];
  
  let posBase = 45;
  let neuBase = 35;
  let negBase = 20;
  
  dates.forEach((date, i) => {
    // 正常波动
    posBase += (Math.random() * 4 - 2);
    neuBase += (Math.random() * 4 - 2);
    
    // 最后3天负面情绪上升
    if (i > 26) {
      negBase += 5;
      posBase -= 3;
      neuBase -= 2;
    } else {
      negBase += (Math.random() * 3 - 1.5);
    }
    
    // 确保总和约为100
    const sum = posBase + neuBase + negBase;
    const ratio = 100 / sum;
    
    positive.push(Math.max(5, Math.min(80, Math.round(posBase * ratio))));
    neutral.push(Math.max(5, Math.min(80, Math.round(neuBase * ratio))));
    negative.push(Math.max(5, Math.min(80, Math.round(negBase * ratio))));
  });
  
  // 销毁已存在的图表
  if (window.sentimentChartInstance) {
    window.sentimentChartInstance.destroy();
  }
  
  // 创建新图表
  window.sentimentChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [
        {
          label: '正面',
          data: positive,
          borderColor: '#22C55E',
          backgroundColor: 'rgba(34, 197, 94, 0.05)',
          borderWidth: 2,
          tension: 0.4,
          fill: false,
          pointRadius: 0
        },
        {
          label: '中性',
          data: neutral,
          borderColor: '#EAB308',
          backgroundColor: 'rgba(234, 179, 8, 0.05)',
          borderWidth: 2,
          tension: 0.4,
          fill: false,
          pointRadius: 0
        },
        {
          label: '负面',
          data: negative,
          borderColor: '#EF4444',
          backgroundColor: 'rgba(239, 68, 68, 0.05)',
          borderWidth: 2,
          tension: 0.4,
          fill: false,
          pointRadius: 0,
          // 最后三个点突出显示
          pointRadius: function(context) {
            const index = context.dataIndex;
            return index > 26 ? 4 : 0;
          },
          pointBackgroundColor: '#EF4444'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        duration: 1000
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            maxRotation: 0,
            autoSkip: true,
            maxTicksLimit: 8,
            font: {
              size: 10
            }
          }
        },
        y: {
          beginAtZero: true,
          max: 100,
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: 'rgba(255, 255, 255, 0.6)',
            callback: function(value) {
              return value + '%';
            },
            font: {
              size: 10
            }
          }
        }
      },
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: 'rgba(255, 255, 255, 0.7)',
            padding: 15
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `${context.dataset.label}: ${context.raw}%`;
            }
          }
        }
      }
    }
  });
}

// 页面加载时初始化图表
window.addEventListener('load', function() {
  drawTrendChart();
  drawTopicTrendChart();
  drawDriversChart();
  drawSentimentChart();
});
</script>

  <!-- 移动端侧边栏 -->
  <div id="mobile-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="absolute top-0 left-0 bottom-0 w-64 bg-dark-400 transform transition-transform duration-300 -translate-x-full" id="mobile-sidebar-content">
      <!-- 移动端侧边栏内容 - 与桌面端相同 -->
      <div class="flex items-center space-x-2 p-4 border-b border-dark-300">
        <div class="bg-primary/20 p-2 rounded-lg">
          <i class="fa fa-line-chart text-primary text-xl"></i>
        </div>
        <h1 class="text-lg font-bold bg-gradient-to-r from-primary to-secondary text-transparent bg-clip-text">
          气候变化舆情分析平台
        </h1>
      </div>

      <nav class="py-4">
        <ul class="space-y-1 px-2">
          <li>
            <a href="#dashboard" class="mobile-nav-link nav-active flex items-center space-x-3 px-4 py-3 rounded-lg transition-all">
              <i class="fa fa-dashboard w-5 text-center"></i>
              <span>数据概览</span>
            </a>
          </li>
          <li>
            <a href="#trends" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-line-chart w-5 text-center"></i>
              <span>时间趋势</span>
            </a>
          </li>
          <li>
            <a href="#themes" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-tags w-5 text-center"></i>
              <span>主题分析</span>
            </a>
          </li>
          <li>
            <a href="#alerts" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-bell w-5 text-center"></i>
              <span>预警中心</span>
            </a>
          </li>
          <li>
            <a href="#timeline" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-history w-5 text-center"></i>
              <span>气候时间线</span>
            </a>
          </li>
          <li>
            <a href="#news-policy" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-newspaper-o w-5 text-center"></i>
              <span>新闻政策</span>
            </a>
          </li>
          <li>
            <a href="#discussion" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-comments w-5 text-center"></i>
              <span>用户讨论</span>
            </a>
          </li>
          <li>
            <a href="#download-share" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-download w-5 text-center"></i>
              <span>数据分享</span>
            </a>
          </li>
          <li>
            <a href="#future-topic" class="mobile-nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-dark-100 hover:bg-dark-300/50 transition-all">
              <i class="fa fa-magic w-5 text-center"></i>
              <span>AI预测</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // 页面切换功能
    document.addEventListener('DOMContentLoaded', function() {
      // 情感倾向环形图
      const ctx = document.getElementById('sentiment-donut');
      if (ctx) {
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['消极', '中立', '积极'],
            datasets: [{
              data: [45, 30, 25],
              backgroundColor: [
                '#F53F3F',
                '#FF7D00',
                '#00B42A'
              ],
              borderWidth: 0,
              cutout: '70%'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.raw}%`;
                  }
                }
              }
            }
          }
        });
      }

      // 导航链接点击事件 - 桌面端
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();

          // 移除所有导航链接的活跃状态
          navLinks.forEach(l => l.classList.remove('nav-active', 'text-white'));
          navLinks.forEach(l => l.classList.add('text-dark-100'));

          // 设置当前导航链接为活跃状态
          this.classList.add('nav-active', 'text-white');
          this.classList.remove('text-dark-100');

          // 隐藏所有页面内容
          document.querySelectorAll('.page-content').forEach(page => {
            page.classList.add('hidden');
          });

          // 显示对应页面内容
          const targetId = this.getAttribute('href').substring(1) + '-page';
          document.getElementById(targetId).classList.remove('hidden');
        });
      });

      // 移动端菜单
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const mobileSidebarContent = document.getElementById('mobile-sidebar-content');
      const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

      mobileMenuButton.addEventListener('click', function() {
        mobileSidebar.classList.remove('hidden');
        setTimeout(() => {
          mobileSidebarContent.classList.remove('-translate-x-full');
        }, 10);
      });

      mobileSidebar.addEventListener('click', function(e) {
        if (e.target === mobileSidebar) {
          mobileSidebarContent.classList.add('-translate-x-full');
          setTimeout(() => {
            mobileSidebar.classList.add('hidden');
          }, 300);
        }
      });

      mobileNavLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();

          // 移除所有导航链接的活跃状态
          mobileNavLinks.forEach(l => l.classList.remove('nav-active', 'text-white'));
          mobileNavLinks.forEach(l => l.classList.add('text-dark-100'));

          // 设置当前导航链接为活跃状态
          this.classList.add('nav-active', 'text-white');
          this.classList.remove('text-dark-100');

          // 隐藏所有页面内容
          document.querySelectorAll('.page-content').forEach(page => {
            page.classList.add('hidden');
          });

          // 显示对应页面内容
          const targetId = this.getAttribute('href').substring(1) + '-page';
          document.getElementById(targetId).classList.remove('hidden');

          // 关闭移动端侧边栏
          mobileSidebarContent.classList.add('-translate-x-full');
          setTimeout(() => {
            mobileSidebar.classList.add('hidden');
          }, 300);
        });
      });
    });
  </script>
  <!-- 用户认证入口按钮（页面左下角） -->
<div class="absolute bottom-0 left-0  p-2">
  <!-- 登录后显示 -->
  <div id="user-info" class="hidden flex items-center w-full">
    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary mr-3"></div>
    <div>
      <p class="text-xs font-medium text-white" id="user-nickname"></p>
    </div>
    <button id="logout-btn" class="ml-auto px-2 py-1 rounded-lg bg-primary text-white text-xs hover:bg-secondary transition-all">退出</button>
  </div>
  <!-- 未登录时显示 -->
  <div id="user-auth-entry" class="flex items-center w-full">
    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary mr-3"></div>
    <button id="auth-open-btn" class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-secondary transition-all text-xs">登录 / 注册</button>
  </div>
</div>
<!-- 用户认证弹窗模态框 -->
<div id="auth-modal" class="fixed inset-0 z-50 bg-black/50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
  <div class="w-full max-w-[340px] bg-dark-400 rounded-xl shadow-2xl overflow-hidden relative border-2 border-primary">
    <div class="flex justify-between items-center px-6 pt-6 pb-2">
      <div class="font-bold text-lg text-primary">用户认证</div>
      <button id="auth-close-btn" class="p-2 rounded hover:bg-dark-300/60">
        <i class="fa fa-times text-dark-100"></i>
      </button>
    </div>
    <div class="px-6 pb-6">
      <div class="flex justify-center mb-4 space-x-4">
        <button id="login-tab" class="auth-tab-btn active px-4 py-2 rounded-lg bg-primary text-white font-medium transition-all">登录</button>
        <button id="register-tab" class="auth-tab-btn px-4 py-2 rounded-lg bg-dark-300 text-primary font-medium transition-all">注册</button>
      </div>
      <!-- 登录表单 -->
      <form id="login-form" autocomplete="off" style="display:block;" onsubmit="return false;">
        <div class="mb-3">
          <label class="text-xs text-dark-100" for="login-username">用户名</label>
          <input type="text" id="login-username" class="w-full px-3 py-2 rounded-lg bg-dark-300 text-white border border-primary/30 focus:ring-2 focus:ring-primary outline-none mt-1" autocomplete="username" required>
        </div>
        <div class="mb-3">
          <label class="text-xs text-dark-100" for="login-password">密码</label>
          <input type="password" id="login-password" class="w-full px-3 py-2 rounded-lg bg-dark-300 text-white border border-primary/30 focus:ring-2 focus:ring-primary outline-none mt-1" autocomplete="current-password" required>
        </div>
        <button type="submit" id="login-btn" class="w-full py-2 bg-primary text-white rounded-lg font-bold mt-2 hover:bg-secondary transition-all">登录</button>
        <div id="login-msg" class="text-warning text-xs mt-2 text-center min-h-[1.2em]"></div>
      </form>
      <!-- 注册表单 -->
      <form id="register-form" autocomplete="off" style="display:none;" onsubmit="return false;">
        <div class="mb-3">
          <label class="text-xs text-dark-100" for="register-username">用户名</label>
          <input type="text" id="register-username" class="w-full px-3 py-2 rounded-lg bg-dark-300 text-white border border-primary/30 focus:ring-2 focus:ring-primary outline-none mt-1" autocomplete="username" required>
        </div>
        <div class="mb-3">
          <label class="text-xs text-dark-100" for="register-password">密码</label>
          <input type="password" id="register-password" class="w-full px-3 py-2 rounded-lg bg-dark-300 text-white border border-primary/30 focus:ring-2 focus:ring-primary outline-none mt-1" autocomplete="new-password" required>
        </div>
        <button type="submit" id="register-btn" class="w-full py-2 bg-primary text-white rounded-lg font-bold mt-2 hover:bg-secondary transition-all">注册</button>
        <div id="register-msg" class="text-warning text-xs mt-2 text-center min-h-[1.2em]"></div>
      </form>
    </div>
  </div>
</div>

<!-- 用户认证JS逻辑 -->
<script>
function showAuthModal(show) {
  const modal = document.getElementById("auth-modal");
  if (show) {
    modal.classList.remove("opacity-0", "pointer-events-none");
    document.body.style.overflow = "hidden";
  } else {
    modal.classList.add("opacity-0", "pointer-events-none");
    document.body.style.overflow = "";
  }
}
function setTab(tab) {
  document.getElementById('login-tab').classList.toggle('active', tab === 'login');
  document.getElementById('register-tab').classList.toggle('active', tab === 'register');
  document.getElementById('login-form').style.display = tab === 'login' ? 'block' : 'none';
  document.getElementById('register-form').style.display = tab === 'register' ? 'block' : 'none';
  document.getElementById('login-msg').innerText = '';
  document.getElementById('register-msg').innerText = '';
}

// 打开/关闭模态框
document.getElementById('auth-open-btn').onclick = () => showAuthModal(true);
document.getElementById('auth-close-btn').onclick = () => showAuthModal(false);
// ESC键关闭
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') showAuthModal(false);
});
document.getElementById('login-tab').onclick = () => setTab('login');
document.getElementById('register-tab').onclick = () => setTab('register');

// 注册
document.getElementById('register-btn').onclick = async function () {
  const username = document.getElementById('register-username').value.trim();
  const password = document.getElementById('register-password').value.trim();
  if (!username || !password) {
    document.getElementById('register-msg').innerText = '请输入用户名和密码';
    return;
  }
  document.getElementById('register-msg').innerText = '注册中...';
  try {
    const resp = await fetch('/api/register', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({username, password})
    });
    const data = await resp.json();
    if (resp.ok) {
      document.getElementById('register-msg').innerText = '注册成功！请登录';
      setTab('login');
    } else {
      document.getElementById('register-msg').innerText = data.error || '注册失败';
    }
  } catch {
    document.getElementById('register-msg').innerText = '网络错误，请稍后再试';
  }
};

// 登录
document.getElementById('login-btn').onclick = async function () {
  const username = document.getElementById('login-username').value.trim();
  const password = document.getElementById('login-password').value.trim();
  if (!username || !password) {
    document.getElementById('login-msg').innerText = '请输入用户名和密码';
    return;
  }
  document.getElementById('login-msg').innerText = '登录中...';
  try {
    const resp = await fetch('/api/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({username, password})
    });
    const data = await resp.json();
    if (resp.ok) {
      document.getElementById('login-msg').innerText = '';
      await showUserInfo();
      showAuthModal(false);
    } else {
      document.getElementById('login-msg').innerText = data.error || '登录失败';
    }
  } catch {
    document.getElementById('login-msg').innerText = '网络错误，请稍后再试';
  }
};

async function showUserInfo() {
  try {
    const resp = await fetch('/api/profile');
    const data = await resp.json();
    if (resp.ok && data.username) {
      document.getElementById('user-info').style.display = 'flex';
      document.getElementById('user-auth-entry').style.display = 'none';
      document.getElementById('user-nickname').innerText = data.username;
    } else {
      document.getElementById('user-info').style.display = 'none';
      document.getElementById('user-auth-entry').style.display = 'flex';
    }
  } catch {
    document.getElementById('user-info').style.display = 'none';
    document.getElementById('user-auth-entry').style.display = 'flex';
  }
}

document.getElementById('logout-btn').onclick = async function () {
  await fetch('/api/logout', {method: 'POST'});
  showUserInfo();
};

// 页面加载时检查登录状态
window.onload = showUserInfo;

</script>
<style>
.auth-tab-btn.active {
  background: #165DFF !important;
  color: #fff !important;
}
</style>
</body>
</html>
